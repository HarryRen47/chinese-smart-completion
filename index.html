<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­æ–‡æ™ºèƒ½ç»­å†™å·¥å…· - åœ¨çº¿æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            text-align: center;
            padding: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .main {
            padding: 30px;
        }
        
        .tabs-container {
            margin-bottom: 25px;
        }
        
        .tab-nav {
            display: flex;
            background: #f1f5f9;
            border-radius: 12px 12px 0 0;
            padding: 8px;
            gap: 4px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .tab-nav::-webkit-scrollbar {
            display: none;
        }
        
        .tab-btn {
            padding: 8px 14px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 12px;
            font-weight: 500;
            color: #64748b;
            background: transparent;
            border: none;
            flex-shrink: 0;
        }
        
        .tab-btn:hover {
            background: #e2e8f0;
            color: #475569;
        }
        
        .tab-btn.active {
            background: #4f46e5;
            color: white;
            box-shadow: 0 2px 4px rgba(79, 70, 229, 0.3);
        }
        
        .tab-content {
            background: #f8fafc;
            border-radius: 0 0 12px 12px;
            border-top: 1px solid #e2e8f0;
        }
        
        .tab-panel {
            display: none;
            padding: 20px;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
        }
        
        .example-btn {
            padding: 10px 15px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 14px;
        }
        
        .example-btn:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
            transform: translateY(-1px);
        }
        
        .input-section {
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        #userInput {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        #userInput:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .btn {
            padding: 15px 25px;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }
        
        .btn-debug {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            font-size: 12px;
            padding: 10px 12px;
        }
        
        .result-section {
            margin-bottom: 30px;
        }
        
        .result-section h3 {
            margin-bottom: 15px;
            color: #374151;
            font-size: 18px;
        }
        
        .result-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            min-height: 60px;
            font-size: 16px;
            position: relative;
        }
        
        .result-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .result-empty {
            color: #64748b;
            font-style: italic;
        }
        
        .result-success {
            color: #059669;
            font-weight: 500;
        }
        
        .result-error {
            color: #dc2626;
        }
        
        .category-tag {
            display: inline-block;
            padding: 4px 8px;
            background: #e0e7ff;
            color: #3730a3;
            border-radius: 6px;
            font-size: 12px;
            margin-right: 8px;
        }
        
        .loading {
            display: none;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f4f6;
            border-top: 2px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .history {
            margin-top: 40px;
        }
        
        .history h3 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: #374151;
            font-size: 18px;
        }
        
        .clear-btn {
            font-size: 14px;
            padding: 8px 16px;
        }
        
        .history-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .history-input {
            font-weight: 500;
            color: #374151;
            margin-bottom: 5px;
        }
        
        .history-result {
            color: #6b7280;
            font-size: 14px;
        }
        
        .debug-panel {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            max-width: 400px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            z-index: 1000;
        }
        
        .debug-log {
            margin-bottom: 5px;
            padding: 2px 0;
            border-bottom: 1px solid #333;
        }
        
        .debug-timestamp {
            color: #888;
            margin-right: 8px;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .main {
                padding: 20px;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .examples {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .debug-panel {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  ä¸­æ–‡æ™ºèƒ½ç»­å†™å·¥å…·</h1>
            <p>æ”¯æŒæ•°å­¦è®¡ç®—ã€æ—¥æœŸæ—¶é—´ã€å•ä½è½¬æ¢ã€æ±‡ç‡æ¢ç®—ç­‰8å¤§ç±»æ™ºèƒ½ç»­å†™åŠŸèƒ½</p>
        </div>
        
        <div class="main">
            <!-- ç¤ºä¾‹Tab - ç§»åˆ°è¾“å…¥æ¡†ä¸Šæ–¹ -->
            <div class="tabs-container">
                <div class="tab-nav">
                    <button class="tab-btn active" onclick="switchTab('math')">ğŸ”¢ æ•°å­¦è®¡ç®—</button>
                    <button class="tab-btn" onclick="switchTab('date')">ğŸ“… æ—¥æœŸæ—¶é—´</button>
                    <button class="tab-btn" onclick="switchTab('timezone')">ğŸŒ æ—¶åŒºæŸ¥è¯¢</button>
                    <button class="tab-btn" onclick="switchTab('unit')">ğŸ”„ å•ä½è½¬æ¢</button>
                    <button class="tab-btn" onclick="switchTab('currency')">ğŸ’° æ±‡ç‡æ¢ç®—</button>
                    <button class="tab-btn" onclick="switchTab('formula')">ğŸ“ å…¬å¼å®šå¾‹</button>
                    <button class="tab-btn" onclick="switchTab('calorie')">ğŸ çƒ­é‡æŸ¥è¯¢</button>
                    <button class="tab-btn" onclick="switchTab('zodiac')">ğŸ² ç”Ÿè‚–æŸ¥è¯¢</button>
                    <button class="tab-btn" onclick="switchTab('constellation')">â­ æ˜Ÿåº§æŸ¥è¯¢</button>
                </div>
                
                <div class="tab-content">
                    <div id="tab-math" class="tab-panel active">
                        <div class="examples">
                            <!-- åŸºç¡€è¿ç®— -->
                            <div class="example-btn" onclick="setInput('1+1')">1+1</div>
                            <div class="example-btn" onclick="setInput('10-3')">10-3</div>
                            <div class="example-btn" onclick="setInput('5*6')">5*6</div>
                            <div class="example-btn" onclick="setInput('20/4')">20/4</div>
                            <!-- ä¸­æ–‡è¿ç®— -->
                            <div class="example-btn" onclick="setInput('8åŠ 7')">8åŠ 7</div>
                            <div class="example-btn" onclick="setInput('15å‡6')">15å‡6</div>
                            <div class="example-btn" onclick="setInput('4ä¹˜9')">4ä¹˜9</div>
                            <div class="example-btn" onclick="setInput('18é™¤3')">18é™¤3</div>
                            <!-- å¹³æ–¹æ ¹ç­‰ -->
                            <div class="example-btn" onclick="setInput('9çš„å¹³æ–¹æ ¹')">9çš„å¹³æ–¹æ ¹</div>
                            <div class="example-btn" onclick="setInput('27çš„ç«‹æ–¹æ ¹')">27çš„ç«‹æ–¹æ ¹</div>
                            <div class="example-btn" onclick="setInput('5çš„å¹³æ–¹')">5çš„å¹³æ–¹</div>
                            <div class="example-btn" onclick="setInput('3çš„ç«‹æ–¹')">3çš„ç«‹æ–¹</div>
                            <!-- æ‰“æŠ˜è®¡ç®— -->
                            <div class="example-btn" onclick="setInput('299æ‰“7æŠ˜')">299æ‰“7æŠ˜</div>
                            <div class="example-btn" onclick="setInput('åŸä»·500æ‰“8æŠ˜')">åŸä»·500æ‰“8æŠ˜</div>
                            <!-- ç™¾åˆ†æ¯”è®¡ç®— -->
                            <div class="example-btn" onclick="setInput('100çš„20%')">100çš„20%</div>
                            <div class="example-btn" onclick="setInput('25%çš„80')">25%çš„80</div>
                            <!-- åˆ†æœŸè®¡ç®— -->
                            <div class="example-btn" onclick="setInput('12000åˆ†æœŸ12æœŸ')">12000åˆ†æœŸ12æœŸ</div>
                        </div>
                    </div>
                    
                    <div id="tab-date" class="tab-panel">
                        <div class="examples">
                            <!-- ç›¸å¯¹æ—¥æœŸ -->
                            <div class="example-btn" onclick="setInput('3å¤©å')">3å¤©å</div>
                            <div class="example-btn" onclick="setInput('2å‘¨å‰')">2å‘¨å‰</div>
                            <div class="example-btn" onclick="setInput('1ä¸ªæœˆå')">1ä¸ªæœˆå</div>
                            <div class="example-btn" onclick="setInput('2å¹´å‰')">2å¹´å‰</div>
                            <div class="example-btn" onclick="setInput('5å¤©å†…')">5å¤©å†…</div>
                            <!-- å¿«é€Ÿæ—¥æœŸ -->
                            <div class="example-btn" onclick="setInput('æ˜å¤©')">æ˜å¤©</div>
                            <div class="example-btn" onclick="setInput('åå¤©')">åå¤©</div>
                            <div class="example-btn" onclick="setInput('æ˜¨å¤©')">æ˜¨å¤©</div>
                            <div class="example-btn" onclick="setInput('å‰å¤©')">å‰å¤©</div>
                            <div class="example-btn" onclick="setInput('å¤§åå¤©')">å¤§åå¤©</div>
                            <!-- å‘¨æœŸæ—¥æœŸ -->
                            <div class="example-btn" onclick="setInput('ä¸‹å‘¨ä¸€')">ä¸‹å‘¨ä¸€</div>
                            <div class="example-btn" onclick="setInput('ä¸Šå‘¨äº”')">ä¸Šå‘¨äº”</div>
                            <div class="example-btn" onclick="setInput('ä¸‹ä¸ªæœˆ')">ä¸‹ä¸ªæœˆ</div>
                            <div class="example-btn" onclick="setInput('æ˜å¹´')">æ˜å¹´</div>
                            <!-- å…·ä½“æ—¥æœŸ -->
                            <div class="example-btn" onclick="setInput('10æœˆ1æ—¥')">10æœˆ1æ—¥</div>
                            <div class="example-btn" onclick="setInput('2024å¹´12æœˆ25æ—¥')">2024å¹´12æœˆ25æ—¥</div>
                            <!-- è·ç¦»è®¡ç®— -->
                            <div class="example-btn" onclick="setInput('è·ç¦»10æœˆ1æ—¥è¿˜å‰©')">è·ç¦»10æœˆ1æ—¥è¿˜å‰©</div>
                            <!-- æœ¬å‘¨æ—¥æœŸ -->
                            <div class="example-btn" onclick="setInput('æœ¬å‘¨äº”')">æœ¬å‘¨äº”</div>
                        </div>
                    </div>
                    
                    <div id="tab-timezone" class="tab-panel">
                        <div class="examples">
                            <!-- åŸå¸‚æ—¶é—´ -->
                            <div class="example-btn" onclick="setInput('çº½çº¦æ—¶é—´')">çº½çº¦æ—¶é—´</div>
                            <div class="example-btn" onclick="setInput('ä¼¦æ•¦æ—¶é—´')">ä¼¦æ•¦æ—¶é—´</div>
                            <div class="example-btn" onclick="setInput('ä¸œäº¬æ—¶é—´')">ä¸œäº¬æ—¶é—´</div>
                            <div class="example-btn" onclick="setInput('å·´é»æ—¶é—´')">å·´é»æ—¶é—´</div>
                            <div class="example-btn" onclick="setInput('æ‚‰å°¼æ—¶é—´')">æ‚‰å°¼æ—¶é—´</div>
                            <!-- ç‰¹å®šæ—¶é—´æ ¼å¼ -->
                            <div class="example-btn" onclick="setInput('9ç‚¹çº½çº¦æ—¶é—´')">9ç‚¹çº½çº¦æ—¶é—´</div>
                            <div class="example-btn" onclick="setInput('15:30ä¼¦æ•¦æ—¶é—´')">15:30ä¼¦æ•¦æ—¶é—´</div>
                            <!-- ç°åœ¨æ—¶é—´ -->
                            <div class="example-btn" onclick="setInput('ç°åœ¨ä¸œäº¬æ—¶é—´')">ç°åœ¨ä¸œäº¬æ—¶é—´</div>
                            <div class="example-btn" onclick="setInput('ç°åœ¨æ´›æ‰çŸ¶å‡ ç‚¹')">ç°åœ¨æ´›æ‰çŸ¶å‡ ç‚¹</div>
                            <!-- ç–‘é—®æ ¼å¼ -->
                            <div class="example-btn" onclick="setInput('ä¼¦æ•¦ç°åœ¨å‡ ç‚¹')">ä¼¦æ•¦ç°åœ¨å‡ ç‚¹</div>
                            <div class="example-btn" onclick="setInput('è¿ªæ‹œç°åœ¨æ—¶é—´')">è¿ªæ‹œç°åœ¨æ—¶é—´</div>
                        </div>
                    </div>
                    
                    <div id="tab-unit" class="tab-panel">
                        <div class="examples">
                            <!-- æ¸©åº¦è½¬æ¢ -->
                            <div class="example-btn" onclick="setInput('37æ‘„æ°åº¦ç­‰äº')">37æ‘„æ°åº¦ç­‰äº</div>
                            <div class="example-btn" onclick="setInput('100åæ°åº¦')">100åæ°åº¦</div>
                            <div class="example-btn" onclick="setInput('0â„ƒ')">0â„ƒ</div>
                            <div class="example-btn" onclick="setInput('212â„‰è½¬æ¢ä¸º')">212â„‰è½¬æ¢ä¸º</div>
                            <!-- é•¿åº¦è½¬æ¢ -->
                            <div class="example-btn" onclick="setInput('100ç±³')">100ç±³</div>
                            <div class="example-btn" onclick="setInput('50å˜ç±³ç­‰äº')">50å˜ç±³ç­‰äº</div>
                            <div class="example-btn" onclick="setInput('1000æ¯«ç±³')">1000æ¯«ç±³</div>
                            <div class="example-btn" onclick="setInput('5åƒç±³')">5åƒç±³</div>
                            <div class="example-btn" onclick="setInput('10è‹±å°º')">10è‹±å°º</div>
                            <div class="example-btn" onclick="setInput('12è‹±å¯¸è½¬æˆ')">12è‹±å¯¸è½¬æˆ</div>
                            <!-- é‡é‡è½¬æ¢ -->
                            <div class="example-btn" onclick="setInput('1å…¬æ–¤')">1å…¬æ–¤</div>
                            <div class="example-btn" onclick="setInput('500å…‹ç­‰äº')">500å…‹ç­‰äº</div>
                            <div class="example-btn" onclick="setInput('2ç£…')">2ç£…</div>
                            <div class="example-btn" onclick="setInput('1å¨è½¬æ¢ä¸º')">1å¨è½¬æ¢ä¸º</div>
                            <!-- é¢ç§¯è½¬æ¢ -->
                            <div class="example-btn" onclick="setInput('1äº©ç­‰äº')">1äº©ç­‰äº</div>
                            <div class="example-btn" onclick="setInput('100å¹³æ–¹ç±³')">100å¹³æ–¹ç±³</div>
                            <div class="example-btn" onclick="setInput('1è‹±äº©')">1è‹±äº©</div>
                            <!-- ä½“ç§¯è½¬æ¢ -->
                            <div class="example-btn" onclick="setInput('1å‡')">1å‡</div>
                            <div class="example-btn" onclick="setInput('500æ¯«å‡')">500æ¯«å‡</div>
                            <div class="example-btn" onclick="setInput('1åŠ ä»‘ç­‰äº')">1åŠ ä»‘ç­‰äº</div>
                        </div>
                    </div>
                    
                    <div id="tab-currency" class="tab-panel">
                        <div class="examples">
                            <!-- ç¾å…ƒæ¢ç®— -->
                            <div class="example-btn" onclick="setInput('1ç¾å…ƒ')">1ç¾å…ƒ</div>
                            <div class="example-btn" onclick="setInput('100ç¾å…ƒç­‰äº')">100ç¾å…ƒç­‰äº</div>
                            <div class="example-btn" onclick="setInput('50USD')">50USD</div>
                            <!-- äººæ°‘å¸æ¢ç®— -->
                            <div class="example-btn" onclick="setInput('100äººæ°‘å¸')">100äººæ°‘å¸</div>
                            <div class="example-btn" onclick="setInput('500äººæ°‘å¸æ¢ç®—æˆ')">500äººæ°‘å¸æ¢ç®—æˆ</div>
                            <div class="example-btn" onclick="setInput('1000CNY')">1000CNY</div>
                            <!-- å…¶ä»–è´§å¸ -->
                            <div class="example-btn" onclick="setInput('1æ¬§å…ƒ')">1æ¬§å…ƒ</div>
                            <div class="example-btn" onclick="setInput('10è‹±é•‘')">10è‹±é•‘</div>
                            <div class="example-btn" onclick="setInput('1000æ—¥å…ƒ')">1000æ—¥å…ƒ</div>
                            <div class="example-btn" onclick="setInput('100æ¸¯å¸å…‘æ¢')">100æ¸¯å¸å…‘æ¢</div>
                            <div class="example-btn" onclick="setInput('50EUR')">50EUR</div>
                            <div class="example-btn" onclick="setInput('20GBP')">20GBP</div>
                        </div>
                    </div>
                    
                    <div id="tab-formula" class="tab-panel">
                        <div class="examples">
                            <!-- ç‰©ç†å®šå¾‹ -->
                            <div class="example-btn" onclick="setInput('ç‰›é¡¿ç¬¬äºŒå®šå¾‹')">ç‰›é¡¿ç¬¬äºŒå®šå¾‹</div>
                            <div class="example-btn" onclick="setInput('ç‰›é¡¿ç¬¬ä¸€å®šå¾‹æ˜¯ä»€ä¹ˆ')">ç‰›é¡¿ç¬¬ä¸€å®šå¾‹æ˜¯ä»€ä¹ˆ</div>
                            <div class="example-btn" onclick="setInput('ç‰›é¡¿ç¬¬ä¸‰å®šå¾‹')">ç‰›é¡¿ç¬¬ä¸‰å®šå¾‹</div>
                            <div class="example-btn" onclick="setInput('æ¬§å§†å®šå¾‹')">æ¬§å§†å®šå¾‹</div>
                            <div class="example-btn" onclick="setInput('ä¸‡æœ‰å¼•åŠ›å®šå¾‹')">ä¸‡æœ‰å¼•åŠ›å®šå¾‹</div>
                            <div class="example-btn" onclick="setInput('èƒ½é‡å®ˆæ’å®šå¾‹æ˜¯ä»€ä¹ˆ')">èƒ½é‡å®ˆæ’å®šå¾‹æ˜¯ä»€ä¹ˆ</div>
                            <!-- æ•°å­¦å…¬å¼ -->
                            <div class="example-btn" onclick="setInput('å‹¾è‚¡å®šç†')">å‹¾è‚¡å®šç†</div>
                            <div class="example-btn" onclick="setInput('äºŒæ¬¡æ–¹ç¨‹æ˜¯ä»€ä¹ˆ')">äºŒæ¬¡æ–¹ç¨‹æ˜¯ä»€ä¹ˆ</div>
                            <div class="example-btn" onclick="setInput('åœ†çš„é¢ç§¯å…¬å¼')">åœ†çš„é¢ç§¯å…¬å¼</div>
                            <div class="example-btn" onclick="setInput('çƒçš„ä½“ç§¯å…¬å¼')">çƒçš„ä½“ç§¯å…¬å¼</div>
                            <!-- åŒ–å­¦åˆ†å­å¼ -->
                            <div class="example-btn" onclick="setInput('æ°´çš„åˆ†å­å¼')">æ°´çš„åˆ†å­å¼</div>
                            <div class="example-btn" onclick="setInput('äºŒæ°§åŒ–ç¢³åˆ†å­å¼æ˜¯ä»€ä¹ˆ')">äºŒæ°§åŒ–ç¢³åˆ†å­å¼æ˜¯ä»€ä¹ˆ</div>
                            <div class="example-btn" onclick="setInput('æ°§æ°”çš„åŒ–å­¦å¼')">æ°§æ°”çš„åŒ–å­¦å¼</div>
                            <div class="example-btn" onclick="setInput('ç”²çƒ·')">ç”²çƒ·</div>
                            <div class="example-btn" onclick="setInput('ä¹™é†‡çš„åˆ†å­å¼')">ä¹™é†‡çš„åˆ†å­å¼</div>
                            <!-- ç‰©ç†å¸¸æ•° -->
                            <div class="example-btn" onclick="setInput('å…‰é€Ÿæ˜¯å¤šå°‘')">å…‰é€Ÿæ˜¯å¤šå°‘</div>
                            <div class="example-btn" onclick="setInput('å£°é€Ÿ')">å£°é€Ÿ</div>
                            <div class="example-btn" onclick="setInput('é‡åŠ›åŠ é€Ÿåº¦æ˜¯ä»€ä¹ˆ')">é‡åŠ›åŠ é€Ÿåº¦æ˜¯ä»€ä¹ˆ</div>
                            <div class="example-btn" onclick="setInput('æ™®æœ—å…‹å¸¸æ•°')">æ™®æœ—å…‹å¸¸æ•°</div>
                        </div>
                    </div>
                    
                    <div id="tab-calorie" class="tab-panel">
                        <div class="examples">
                            <!-- é‡é‡+é£Ÿç‰©+çƒ­é‡ -->
                            <div class="example-btn" onclick="setInput('100å…‹ç±³é¥­çƒ­é‡')">100å…‹ç±³é¥­çƒ­é‡</div>
                            <div class="example-btn" onclick="setInput('50å…‹é¢æ¡çƒ­é‡')">50å…‹é¢æ¡çƒ­é‡</div>
                            <div class="example-btn" onclick="setInput('200å…‹è‹¹æœçƒ­é‡')">200å…‹è‹¹æœçƒ­é‡</div>
                            <div class="example-btn" onclick="setInput('150gé¸¡è›‹çƒ­é‡')">150gé¸¡è›‹çƒ­é‡</div>
                            <!-- è‡ªç„¶è¡¨è¾¾ -->
                            <div class="example-btn" onclick="setInput('æˆ‘åƒäº†100å…‹ç±³é¥­')">æˆ‘åƒäº†100å…‹ç±³é¥­</div>
                            <div class="example-btn" onclick="setInput('æˆ‘åƒäº†ä¸€ä¸ªè‹¹æœ')">æˆ‘åƒäº†ä¸€ä¸ªè‹¹æœ</div>
                            <div class="example-btn" onclick="setInput('æˆ‘åƒäº†200å…‹ç‰›è‚‰')">æˆ‘åƒäº†200å…‹ç‰›è‚‰</div>
                            <!-- åŸºç¡€çƒ­é‡æŸ¥è¯¢ -->
                            <div class="example-btn" onclick="setInput('è‹¹æœçƒ­é‡')">è‹¹æœçƒ­é‡</div>
                            <div class="example-btn" onclick="setInput('é¦™è•‰çƒ­é‡')">é¦™è•‰çƒ­é‡</div>
                            <div class="example-btn" onclick="setInput('é¸¡èƒ¸è‚‰çƒ­é‡')">é¸¡èƒ¸è‚‰çƒ­é‡</div>
                            <div class="example-btn" onclick="setInput('ç‰›å¥¶çƒ­é‡')">ç‰›å¥¶çƒ­é‡</div>
                            <div class="example-btn" onclick="setInput('é¢åŒ…çƒ­é‡')">é¢åŒ…çƒ­é‡</div>
                            <!-- æ›´å¤šé£Ÿç‰© -->
                            <div class="example-btn" onclick="setInput('è¥¿çº¢æŸ¿çƒ­é‡')">è¥¿çº¢æŸ¿çƒ­é‡</div>
                            <div class="example-btn" onclick="setInput('åœŸè±†çƒ­é‡')">åœŸè±†çƒ­é‡</div>
                            <div class="example-btn" onclick="setInput('é±¼è‚‰çƒ­é‡')">é±¼è‚‰çƒ­é‡</div>
                        </div>
                    </div>
                    
                    <div id="tab-zodiac" class="tab-panel">
                        <div class="examples">
                            <!-- å¹´ä»½æŸ¥ç”Ÿè‚– -->
                            <div class="example-btn" onclick="setInput('1990å¹´å±')">1990å¹´å±</div>
                            <div class="example-btn" onclick="setInput('1998 å¹´å±')">1998 å¹´å±</div>
                            <div class="example-btn" onclick="setInput('2000å¹´å±ä»€ä¹ˆ')">2000å¹´å±ä»€ä¹ˆ</div>
                            <div class="example-btn" onclick="setInput('1985å±ä»€ä¹ˆ')">1985å±ä»€ä¹ˆ</div>
                            <div class="example-btn" onclick="setInput('è¯·é—®2024å¹´å±ä»€ä¹ˆ')">è¯·é—®2024å¹´å±ä»€ä¹ˆ</div>
                            <!-- ç”Ÿè‚–æŸ¥å¹´ä»½ -->
                            <div class="example-btn" onclick="setInput('å±è™çš„å¹´ä»½')">å±è™çš„å¹´ä»½</div>
                            <div class="example-btn" onclick="setInput('å±é¾™çš„å¹´ä»½')">å±é¾™çš„å¹´ä»½</div>
                            <div class="example-btn" onclick="setInput('å±é©¬çš„å¹´ä»½')">å±é©¬çš„å¹´ä»½</div>
                            <div class="example-btn" onclick="setInput('å±çŒ´çš„å¹´ä»½')">å±çŒ´çš„å¹´ä»½</div>
                            <!-- ç”Ÿè‚–æŸ¥è¯¢ -->
                            <div class="example-btn" onclick="setInput('ç”Ÿè‚–é¼ ')">ç”Ÿè‚–é¼ </div>
                            <div class="example-btn" onclick="setInput('ç”Ÿè‚–ç‰›')">ç”Ÿè‚–ç‰›</div>
                            <div class="example-btn" onclick="setInput('ç”Ÿè‚–å…”')">ç”Ÿè‚–å…”</div>
                        </div>
                    </div>

                    <div id="tab-constellation" class="tab-panel">
                        <div class="examples">
                            <!-- æ—¥æœŸæŸ¥æ˜Ÿåº§ -->
                            <div class="example-btn" onclick="setInput('6æœˆ24æ—¥æ˜¯ä»€ä¹ˆæ˜Ÿåº§')">6æœˆ24æ—¥æ˜¯ä»€ä¹ˆæ˜Ÿåº§</div>
                            <div class="example-btn" onclick="setInput('æˆ‘æ˜¯8æœˆ15æ—¥ç”Ÿä»€ä¹ˆæ˜Ÿåº§')">æˆ‘æ˜¯8æœˆ15æ—¥ç”Ÿä»€ä¹ˆæ˜Ÿåº§</div>
                            <div class="example-btn" onclick="setInput('3.21æ˜Ÿåº§')">3.21æ˜Ÿåº§</div>
                            <div class="example-btn" onclick="setInput('12/25ä»€ä¹ˆæ˜Ÿåº§')">12/25ä»€ä¹ˆæ˜Ÿåº§</div>
                            <div class="example-btn" onclick="setInput('ä»Šå¤©ä»€ä¹ˆæ˜Ÿåº§')">ä»Šå¤©ä»€ä¹ˆæ˜Ÿåº§</div>
                            <div class="example-btn" onclick="setInput('æ˜å¤©æ˜Ÿåº§')">æ˜å¤©æ˜Ÿåº§</div>
                            <!-- æ˜Ÿåº§æŸ¥æ—¥æœŸ -->
                            <div class="example-btn" onclick="setInput('ç‹®å­åº§æ—¥æœŸ')">ç‹®å­åº§æ—¥æœŸ</div>
                            <div class="example-btn" onclick="setInput('åŒå­åº§ä»€ä¹ˆæ—¶å€™')">åŒå­åº§ä»€ä¹ˆæ—¶å€™</div>
                            <div class="example-btn" onclick="setInput('å¤©èåº§æ—¶é—´')">å¤©èåº§æ—¶é—´</div>
                            <div class="example-btn" onclick="setInput('ç™½ç¾Šåº§æ—¥æœŸ')">ç™½ç¾Šåº§æ—¥æœŸ</div>
                            <div class="example-btn" onclick="setInput('æ°´ç“¶åº§ä»€ä¹ˆæ—¶å€™')">æ°´ç“¶åº§ä»€ä¹ˆæ—¶å€™</div>
                            <div class="example-btn" onclick="setInput('æ‘©ç¾¯åº§æ—¶é—´')">æ‘©ç¾¯åº§æ—¶é—´</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="input-section">
                <div class="input-group">
                    <input type="text" id="userInput" placeholder="åœ¨è¿™é‡Œè¾“å…¥ä»»ä½•å†…å®¹ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¯†åˆ«å¹¶æ™ºèƒ½ç»­å†™..." />
                    <button class="btn" onclick="processInput()">æ™ºèƒ½ç»­å†™</button>
                    <button class="btn btn-debug" id="debugBtn" onclick="toggleDebug()">ğŸ› è°ƒè¯•</button>
                </div>
            </div>
            
            <!-- ç»­å†™ç»“æœ - ç´§è·Ÿåœ¨è¾“å…¥æ¡†ä¸‹æ–¹ -->
            <div class="result-section">
                <h3>ğŸ“ ç»­å†™ç»“æœ</h3>
                <div class="result-box">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                    <div id="result" class="result-content result-empty">
                        åœ¨ä¸Šæ–¹è¾“å…¥å†…å®¹ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¯†åˆ«å¹¶æ™ºèƒ½ç»­å†™
                    </div>
                </div>
            </div>
            
            <div class="history">
                <h3>ğŸ“š æµ‹è¯•å†å² 
                    <button class="btn btn-secondary clear-btn" onclick="clearHistory()">æ¸…ç©ºå†å²</button>
                </h3>
                <div id="historyContainer">
                    <div style="text-align: center; color: #64748b; padding: 20px;">
                        æš‚æ— æµ‹è¯•è®°å½•
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è°ƒè¯•é¢æ¿ -->
    <div id="debugPanel" class="debug-panel">
        <div style="font-weight: bold; margin-bottom: 10px;">ğŸ› å®æ—¶è°ƒè¯•æ—¥å¿—</div>
        <div id="debugLogs"></div>
    </div>

    <script>
        // æ™ºèƒ½ç»­å†™å¼•æ“æ ¸å¿ƒä»£ç 
        class ChineseSmartCompletion {
            constructor() {
                this.rules = this.initializeRules();
                this.cache = new Map();
                this.initializeData();
            }

            initializeRules() {
                return [
                    {
                        category: 'math',
                        priority: 1,
                        patterns: [
                            /^(\d+(?:\.\d+)?)\s*([+\-*/])\s*(\d+(?:\.\d+)?)$/,
                            /^(\d+(?:\.\d+)?)\s*(åŠ |å‡|ä¹˜|é™¤)\s*(\d+(?:\.\d+)?)$/,
                            /^(\d+(?:\.\d+)?)\s*çš„?\s*(å¹³æ–¹æ ¹|ç«‹æ–¹æ ¹|å¹³æ–¹|ç«‹æ–¹)$/,
                            /^(\d+(?:\.\d+)?)\s*æ‰“\s*(\d+(?:\.\d+)?)\s*æŠ˜$/,
                            /^.*?åŸä»·\s*(\d+(?:\.\d+)?)\s*æ‰“\s*(\d+(?:\.\d+)?)\s*æŠ˜$/,
                            /^.*?(\d+(?:\.\d+)?)\s*çš„\s*(\d+(?:\.\d+)?)\s*%$/,
                            /^.*?(\d+(?:\.\d+)?)\s*%\s*çš„\s*(\d+(?:\.\d+)?)$/,
                            /^.*?(\d+(?:\.\d+)?)\s*åˆ†æœŸ\s*(\d+)\s*æœŸ$/,
                            // æ–°å¢ç§‘å­¦è®¡ç®—
                            /^.*?(\d+(?:\.\d+)?)\s*çš„?\s*(é˜¶ä¹˜|!)$/,
                            /^.*?(sin|cos|tan|sinh|cosh|tanh)\s*(\d+(?:\.\d+)?)$/,
                            /^.*?(log|ln|lg)\s*(\d+(?:\.\d+)?)$/,
                            /^.*?(\d+(?:\.\d+)?)\s*çš„\s*(\d+(?:\.\d+)?)\s*æ¬¡æ–¹$/,
                            /^.*?e\s*çš„\s*(\d+(?:\.\d+)?)\s*æ¬¡æ–¹$/,
                            /^.*?(\d+)\s*è¿›åˆ¶è½¬\s*(\d+)\s*è¿›åˆ¶\s*(\d+)$/
                        ],
                        handler: this.handleMathCalculation.bind(this)
                    },
                    {
                        category: 'date',
                        priority: 2,
                        patterns: [
                            /^.*?(\d+)\s*(å¤©|æ—¥|å‘¨|æœˆ|å¹´)\s*(å|å‰|å†…)$/,
                            /^.*?(ä»Šå¤©|æ˜å¤©|åå¤©|æ˜¨å¤©|å‰å¤©|å¤§åå¤©)$/,
                            /^.*?(ä¸‹å‘¨|ä¸Šå‘¨|ä¸‹ä¸ªæœˆ|ä¸Šä¸ªæœˆ|æ˜å¹´|å»å¹´)\s*(ä¸€|äºŒ|ä¸‰|å››|äº”|å…­|æ—¥|å¤©|æœˆ)?$/,
                            /^.*?(\d+)\s*æœˆ\s*(\d+)\s*æ—¥$/,
                            /^.*?(\d{4})\s*å¹´\s*(\d+)\s*æœˆ\s*(\d+)\s*æ—¥$/,
                            /^.*?è·ç¦»\s*(\d+)\s*æœˆ\s*(\d+)\s*æ—¥\s*(è¿˜æœ‰|å·²è¿‡|è¿˜å‰©)$/,
                            /^.*?æœ¬å‘¨\s*(ä¸€|äºŒ|ä¸‰|å››|äº”|å…­|æ—¥)$/,
                            // æ–°å¢å†œå†å’ŒèŠ‚å‡æ—¥
                            /^.*?(ä»Šå¤©|æ˜å¤©|æ˜¨å¤©)\s*å†œå†[ï¼Ÿ?]?$/,
                            /^.*?å†œå†\s*(\d+)\s*æœˆ\s*(\d+)\s*æ—¥$/,
                            /^.*?(æ˜¥èŠ‚|æ¸…æ˜èŠ‚|åŠ³åŠ¨èŠ‚|ç«¯åˆèŠ‚|ä¸­ç§‹èŠ‚|å›½åº†èŠ‚)\s*(æ˜¯å“ªå¤©|ä»€ä¹ˆæ—¶å€™)[ï¼Ÿ?]?$/,
                            /^.*?ä¸‹ä¸ª?\s*(æ˜¥èŠ‚|æ¸…æ˜èŠ‚|åŠ³åŠ¨èŠ‚|ç«¯åˆèŠ‚|ä¸­ç§‹èŠ‚|å›½åº†èŠ‚)[ï¼Ÿ?]?$/,
                            /^.*?(\d{4})\s*å¹´\s*(æ˜¥èŠ‚|æ¸…æ˜èŠ‚|åŠ³åŠ¨èŠ‚|ç«¯åˆèŠ‚|ä¸­ç§‹èŠ‚|å›½åº†èŠ‚)[ï¼Ÿ?]?$/
                        ],
                        handler: this.handleDateCalculation.bind(this)
                    },
                    {
                        category: 'timezone',
                        priority: 3,
                        patterns: [
                            /^.*?([\u4e00-\u9fa5]+|[A-Za-z]+)\s*æ—¶é—´[ï¼Ÿ?]?$/,
                            /^.*?(\d{1,2})[:\.]?(\d{2})?\s*(ç‚¹|æ—¶)\s*([\u4e00-\u9fa5]+)\s*(æ—¶é—´)?[ï¼Ÿ?]?$/,
                            /^.*?ç°åœ¨\s*([\u4e00-\u9fa5]+|[A-Za-z]+)\s*(å‡ ç‚¹|æ—¶é—´)[ï¼Ÿ?]?$/,
                            /^.*?([\u4e00-\u9fa5]+|[A-Za-z]+)\s*ç°åœ¨\s*(å‡ ç‚¹|æ—¶é—´)[ï¼Ÿ?]?$/
                        ],
                        handler: this.handleTimezoneQuery.bind(this)
                    },
                    {
                        category: 'unit',
                        priority: 4,
                        patterns: [
                            /^.*?(\d+(?:\.\d+)?)\s*(æ‘„æ°åº¦|åæ°åº¦|â„ƒ|â„‰)\s*(ç­‰äº|è½¬æ¢ä¸º|è½¬æˆ)?[ï¼Ÿ?]?$/,
                            /^.*?(\d+(?:\.\d+)?)\s*(ç±³|å˜ç±³|æ¯«ç±³|åƒç±³|è‹±å°º|è‹±å¯¸|ç |m|cm|mm|km|ft|in|yard)(?:\s*åœ°?)?\s*(ç­‰äº|è½¬æ¢ä¸º|è½¬æˆ)?[ï¼Ÿ?]?$/,
                            /^.*?(\d+(?:\.\d+)?)\s*(å…¬æ–¤|åƒå…‹|å…‹|ç£…|å¨|kg|g|lb|t)\s*(ç­‰äº|è½¬æ¢ä¸º|è½¬æˆ)?[ï¼Ÿ?]?$/,
                            /^.*?(\d+(?:\.\d+)?)\s*(å¹³æ–¹ç±³|å¹³æ–¹åƒç±³|äº©|è‹±äº©|ã¡|kmÂ²)(?:\s*åœ°?)?\s*(ç­‰äº|è½¬æ¢ä¸º|è½¬æˆ)?[ï¼Ÿ?]?$/,
                            /^.*?(\d+(?:\.\d+)?)\s*(å‡|æ¯«å‡|åŠ ä»‘|l|ml|gal)\s*(ç­‰äº|è½¬æ¢ä¸º|è½¬æˆ)?[ï¼Ÿ?]?$/,
                            // æ–°å¢èƒ½é‡å’ŒåŠŸç‡å•ä½
                            /^.*?(\d+(?:\.\d+)?)\s*(åƒç„¦|ç„¦è€³|å¡è·¯é‡Œ|åƒå¡|ç“¦æ—¶|åƒç“¦æ—¶|kJ|J|cal|kcal|Wh|kWh)\s*(ç­‰äº|è½¬æ¢ä¸º|è½¬æˆ)?[ï¼Ÿ?]?$/,
                            /^.*?(\d+(?:\.\d+)?)\s*(ç“¦|åƒç“¦|é©¬åŠ›|å…†ç“¦|W|kW|MW|hp)\s*(ç­‰äº|è½¬æ¢ä¸º|è½¬æˆ)?[ï¼Ÿ?]?$/,
                            /^.*?(\d+(?:\.\d+)?)\s*(å¸•|åƒå¸•|å…†å¸•|æ¯«ç±³æ±æŸ±|å¤§æ°”å‹|Pa|kPa|MPa|mmHg|atm|bar)\s*(ç­‰äº|è½¬æ¢ä¸º|è½¬æˆ)?[ï¼Ÿ?]?$/
                        ],
                        handler: this.handleUnitConversion.bind(this)
                    },
                    {
                        category: 'currency',
                        priority: 5,
                        patterns: [
                            /^.*?(\d+(?:\.\d+)?)\s*(ç¾å…ƒ|äººæ°‘å¸|æ¬§å…ƒ|è‹±é•‘|æ—¥å…ƒ|æ¸¯å¸|USD|CNY|EUR|GBP|JPY|HKD)$/,
                            /^.*?(\d+(?:\.\d+)?)\s*(ç¾å…ƒ|äººæ°‘å¸|æ¬§å…ƒ|è‹±é•‘|æ—¥å…ƒ|æ¸¯å¸)\s*(ç­‰äº|æ¢ç®—æˆ|å…‘æ¢)[ï¼Ÿ?]?$/
                        ],
                        handler: this.handleCurrencyConversion.bind(this)
                    },
                    {
                        category: 'formula',
                        priority: 6,
                        patterns: [
                            /^.*?(ç‰›é¡¿ç¬¬[ä¸€äºŒä¸‰]å®šå¾‹|æ¬§å§†å®šå¾‹|ä¸‡æœ‰å¼•åŠ›å®šå¾‹|èƒ½é‡å®ˆæ’å®šå¾‹)(?:æ˜¯ä»€ä¹ˆ?)?[ï¼Ÿ?]?$/,
                            /^.*?(å‹¾è‚¡å®šç†|äºŒæ¬¡æ–¹ç¨‹|åœ†çš„é¢ç§¯å…¬å¼|çƒçš„ä½“ç§¯å…¬å¼)(?:æ˜¯ä»€ä¹ˆ?)?[ï¼Ÿ?]?$/,
                            /^.*?(æ°´|äºŒæ°§åŒ–ç¢³|æ°§æ°”|ç”²çƒ·|ä¹™é†‡)çš„?(?:åˆ†å­å¼|åŒ–å­¦å¼)(?:æ˜¯ä»€ä¹ˆ?)?[ï¼Ÿ?]?$/,
                            /^(?:.*?)(å…‰é€Ÿ|å£°é€Ÿ|é‡åŠ›åŠ é€Ÿåº¦|æ™®æœ—å…‹å¸¸æ•°)(?:æ˜¯å¤šå°‘?|æ˜¯ä»€ä¹ˆ?)?[ï¼Ÿ?]?$/,
                            // æ–°å¢ç»æµå…¬å¼
                            /^.*?(å¤åˆ©å…¬å¼|å•åˆ©å…¬å¼|ç°å€¼å…¬å¼|ç»ˆå€¼å…¬å¼|å¹´é‡‘å…¬å¼)(?:æ˜¯ä»€ä¹ˆ?)?[ï¼Ÿ?]?$/,
                            /^.*?(GDP|é€šèƒ€ç‡|åˆ©ç‡|æ±‡ç‡|å¸‚ç›ˆç‡|ROI|ROE|EBITDA)(?:æ˜¯ä»€ä¹ˆ?|å¦‚ä½•è®¡ç®—?)?[ï¼Ÿ?]?$/,
                            /^.*?(ä¾›æ±‚æ›²çº¿|è¾¹é™…æˆæœ¬|è¾¹é™…æ”¶ç›Š|å¼¹æ€§ç³»æ•°)(?:æ˜¯ä»€ä¹ˆ?)?[ï¼Ÿ?]?$/,
                            // æ–°å¢ç”Ÿç‰©å…¬å¼
                            /^.*?(DNA|RNA|ATP|ADP|è›‹ç™½è´¨|æ°¨åŸºé…¸)(?:åˆ†å­å¼|ç»“æ„å¼)?(?:æ˜¯ä»€ä¹ˆ?)?[ï¼Ÿ?]?$/,
                            /^.*?(å…‰åˆä½œç”¨|å‘¼å¸ä½œç”¨|è›‹ç™½è´¨åˆæˆ)(?:å…¬å¼|æ–¹ç¨‹å¼)?(?:æ˜¯ä»€ä¹ˆ?)?[ï¼Ÿ?]?$/,
                            /^.*?(ç»†èƒåˆ†è£‚|åŸºå› è¡¨è¾¾|é…¶å‚¬åŒ–)(?:å…¬å¼|æœºåˆ¶)?(?:æ˜¯ä»€ä¹ˆ?)?[ï¼Ÿ?]?$/,
                            /^.*?(ç§ç¾¤å¢é•¿|ç”Ÿæ€ç³»ç»Ÿ|é£Ÿç‰©é“¾)(?:æ¨¡å‹|å…¬å¼)?(?:æ˜¯ä»€ä¹ˆ?)?[ï¼Ÿ?]?$/
                        ],
                        handler: this.handleFormulaQuery.bind(this)
                    },
                    {
                        category: 'calorie',
                        priority: 7,
                        patterns: [
                            /^.*?(?:æˆ‘åƒäº†?)?(\d+)\s*å…‹?\s*(ç±³é¥­|é¢æ¡|è‹¹æœ|é¦™è•‰|é¸¡è›‹|ç‰›å¥¶|é¢åŒ…|åœŸè±†|è¥¿çº¢æŸ¿|é»„ç“œ|é¸¡èƒ¸è‚‰|ç‰›è‚‰|çŒªè‚‰|é±¼è‚‰|ç™½èœ|èƒ¡èåœ|æ©™å­|è‰è“|è‘¡è„|è¥¿ç“œ)[ï¼Œ,]?\s*çƒ­é‡[ï¼Ÿ?]?$/,
                            /^(\d+)\s*å…‹\s*(ç±³é¥­|é¢æ¡|è‹¹æœ|é¦™è•‰|é¸¡è›‹|ç‰›å¥¶|é¢åŒ…|åœŸè±†|è¥¿çº¢æŸ¿|é»„ç“œ|é¸¡èƒ¸è‚‰|ç‰›è‚‰|çŒªè‚‰|é±¼è‚‰|ç™½èœ|èƒ¡èåœ|æ©™å­|è‰è“|è‘¡è„|è¥¿ç“œ)\s*çƒ­é‡[ï¼Ÿ?]?$/,
                            /^(\d+)\s*g\s*(ç±³é¥­|é¢æ¡|è‹¹æœ|é¦™è•‰|é¸¡è›‹|ç‰›å¥¶|é¢åŒ…|åœŸè±†|è¥¿çº¢æŸ¿|é»„ç“œ|é¸¡èƒ¸è‚‰|ç‰›è‚‰|çŒªè‚‰|é±¼è‚‰|ç™½èœ|èƒ¡èåœ|æ©™å­|è‰è“|è‘¡è„|è¥¿ç“œ)\s*çƒ­é‡[ï¼Ÿ?]?$/,
                            /^(ç±³é¥­|é¢æ¡|è‹¹æœ|é¦™è•‰|é¸¡è›‹|ç‰›å¥¶|é¢åŒ…|åœŸè±†|è¥¿çº¢æŸ¿|é»„ç“œ|é¸¡èƒ¸è‚‰|ç‰›è‚‰|çŒªè‚‰|é±¼è‚‰|ç™½èœ|èƒ¡èåœ|æ©™å­|è‰è“|è‘¡è„|è¥¿ç“œ)\s*çƒ­é‡[ï¼Ÿ?]?$/,
                            /^.*?(?:æˆ‘åƒäº†?)?(\d+)\s*å…‹?\s*(ç±³é¥­|é¢æ¡|è‹¹æœ|é¦™è•‰|é¸¡è›‹|ç‰›å¥¶|é¢åŒ…|åœŸè±†|è¥¿çº¢æŸ¿|é»„ç“œ|é¸¡èƒ¸è‚‰|ç‰›è‚‰|çŒªè‚‰|é±¼è‚‰|ç™½èœ|èƒ¡èåœ|æ©™å­|è‰è“|è‘¡è„|è¥¿ç“œ)[ï¼Œ,]?$/
                        ],
                        handler: this.handleCalorieQuery.bind(this)
                    },
                    {
                        category: 'zodiac',
                        priority: 8,
                        patterns: [
                            /^.*?(\d{4})\s*å¹´\s*å±\s*(ä»€ä¹ˆ|å•¥)?[ï¼Ÿ?]?$/,
                            /^.*?(\d{4})\s*å¹´\s*å±$/,
                            /^.*?(\d{4})\s*å±\s*(ä»€ä¹ˆ|å•¥)[ï¼Ÿ?]?$/,
                            /^.*?(\d{4})\s*å±$/,
                            /^.*?å±\s*(é¼ |ç‰›|è™|å…”|é¾™|è›‡|é©¬|ç¾Š|çŒ´|é¸¡|ç‹—|çŒª)\s*çš„\s*å¹´ä»½[ï¼Ÿ?]?$/,
                            /^.*?ç”Ÿè‚–\s*(é¼ |ç‰›|è™|å…”|é¾™|è›‡|é©¬|ç¾Š|çŒ´|é¸¡|ç‹—|çŒª)[ï¼Ÿ?]?$/
                        ],
                        handler: this.handleZodiacQuery.bind(this)
                    },
                    {
                        category: 'constellation',
                        priority: 9,
                        patterns: [
                            /^.*?(\d{1,2})\s*æœˆ\s*(\d{1,2})\s*æ—¥\s*(æ˜¯ä»€ä¹ˆæ˜Ÿåº§|æ˜Ÿåº§)[ï¼Ÿ?]?$/,
                            /^.*?(\d{4})\s*å¹´\s*(\d{1,2})\s*æœˆ\s*(\d{1,2})\s*æ—¥\s*(æ˜¯ä»€ä¹ˆæ˜Ÿåº§|æ˜Ÿåº§)[ï¼Ÿ?]?$/,
                            /^.*?(ç™½ç¾Šåº§|é‡‘ç‰›åº§|åŒå­åº§|å·¨èŸ¹åº§|ç‹®å­åº§|å¤„å¥³åº§|å¤©ç§¤åº§|å¤©èåº§|å°„æ‰‹åº§|æ‘©ç¾¯åº§|æ°´ç“¶åº§|åŒé±¼åº§)\s*(æ—¥æœŸ|æ—¶é—´|ä»€ä¹ˆæ—¶å€™)[ï¼Ÿ?]?$/,
                            /^.*?(ä»Šå¤©|æ˜å¤©|æ˜¨å¤©)\s*(ä»€ä¹ˆæ˜Ÿåº§|æ˜Ÿåº§)[ï¼Ÿ?]?$/,
                            /^.*?æˆ‘æ˜¯\s*(\d{1,2})\s*æœˆ\s*(\d{1,2})\s*æ—¥\s*(ç”Ÿ|å‡ºç”Ÿ)[ï¼Œ,]?\s*(ä»€ä¹ˆæ˜Ÿåº§|æ˜Ÿåº§)[ï¼Ÿ?]?$/,
                            /^.*?(\d{1,2})\s*[æœˆ./]\s*(\d{1,2})\s*[æ—¥å·]?\s*(ä»€ä¹ˆæ˜Ÿåº§|æ˜Ÿåº§)[ï¼Ÿ?]?$/
                        ],
                        handler: this.handleConstellationQuery.bind(this)
                    }
                ];
            }

            initializeData() {
                // æ—¶åŒºæ˜ å°„
                this.timezoneMap = {
                    'çº½çº¦': 'America/New_York',
                    'æ´›æ‰çŸ¶': 'America/Los_Angeles',
                    'ä¼¦æ•¦': 'Europe/London',
                    'å·´é»': 'Europe/Paris',
                    'ä¸œäº¬': 'Asia/Tokyo',
                    'é¦–å°”': 'Asia/Seoul',
                    'æ–°åŠ å¡': 'Asia/Singapore',
                    'è¿ªæ‹œ': 'Asia/Dubai',
                    'æ‚‰å°¼': 'Australia/Sydney',
                    'å¢¨å°”æœ¬': 'Australia/Melbourne',
                    'è«æ–¯ç§‘': 'Europe/Moscow',
                    'æŸæ—': 'Europe/Berlin',
                    'ç½—é©¬': 'Europe/Rome',
                    'å­Ÿä¹°': 'Asia/Kolkata',
                    'æ›¼è°·': 'Asia/Bangkok'
                };

                // å…¬å¼æ•°æ®åº“
                this.formulaDatabase = {
                    'ç‰›é¡¿ç¬¬äºŒå®šå¾‹': 'F = ma',
                    'ç‰›é¡¿ç¬¬ä¸€å®šå¾‹': 'ç‰©ä½“ä¿æŒé™æ­¢æˆ–åŒ€é€Ÿç›´çº¿è¿åŠ¨çŠ¶æ€',
                    'ç‰›é¡¿ç¬¬ä¸‰å®šå¾‹': 'ä½œç”¨åŠ›ä¸åä½œç”¨åŠ›å¤§å°ç›¸ç­‰ï¼Œæ–¹å‘ç›¸å',
                    'æ¬§å§†å®šå¾‹': 'V = IR',
                    'ä¸‡æœ‰å¼•åŠ›å®šå¾‹': 'F = G(mâ‚mâ‚‚)/rÂ²',
                    'èƒ½é‡å®ˆæ’å®šå¾‹': 'E = mcÂ²',
                    'å‹¾è‚¡å®šç†': 'aÂ² + bÂ² = cÂ²',
                    'äºŒæ¬¡æ–¹ç¨‹': 'x = (-b Â± âˆš(bÂ²-4ac)) / 2a',
                    'åœ†çš„é¢ç§¯å…¬å¼': 'S = Ï€rÂ²',
                    'çƒçš„ä½“ç§¯å…¬å¼': 'V = (4/3)Ï€rÂ³',
                    'æ°´çš„åˆ†å­å¼': 'Hâ‚‚O',
                    'äºŒæ°§åŒ–ç¢³': 'COâ‚‚',
                    'æ°§æ°”çš„åŒ–å­¦å¼': 'Oâ‚‚',
                    'ç”²çƒ·': 'CHâ‚„',
                    'ä¹™é†‡': 'Câ‚‚Hâ‚…OH',
                    'å…‰é€Ÿ': '299,792,458 m/s',
                    'å£°é€Ÿ': '343 m/sï¼ˆ20Â°Cç©ºæ°”ä¸­ï¼‰',
                    'é‡åŠ›åŠ é€Ÿåº¦': '9.8 m/sÂ²',
                    'æ™®æœ—å…‹å¸¸æ•°': '6.626Ã—10â»Â³â´ JÂ·s',
                    // ç»æµå…¬å¼
                    'å¤åˆ©å…¬å¼': 'A = P(1 + r)â¿',
                    'å•åˆ©å…¬å¼': 'A = P(1 + rt)',
                    'ç°å€¼å…¬å¼': 'PV = FV / (1 + r)â¿',
                    'ç»ˆå€¼å…¬å¼': 'FV = PV Ã— (1 + r)â¿',
                    'å¹´é‡‘å…¬å¼': 'PMT = PV Ã— [r(1+r)â¿] / [(1+r)â¿-1]',
                    'GDP': 'å›½å†…ç”Ÿäº§æ€»å€¼ = C + I + G + (X - M)',
                    'é€šèƒ€ç‡': 'é€šèƒ€ç‡ = (æœ¬æœŸCPI - ä¸ŠæœŸCPI) / ä¸ŠæœŸCPI Ã— 100%',
                    'å¸‚ç›ˆç‡': 'P/E = è‚¡ä»· / æ¯è‚¡æ”¶ç›Š',
                    'ROI': 'ROI = (æŠ•èµ„æ”¶ç›Š - æŠ•èµ„æˆæœ¬) / æŠ•èµ„æˆæœ¬ Ã— 100%',
                    'ROE': 'ROE = å‡€åˆ©æ¶¦ / è‚¡ä¸œæƒç›Š Ã— 100%',
                    'EBITDA': 'EBITDA = å‡€åˆ©æ¶¦ + åˆ©æ¯ + ç¨æ”¶ + æŠ˜æ—§ + æ‘Šé”€',
                    // ç”Ÿç‰©å…¬å¼
                    'DNA': 'è„±æ°§æ ¸ç³–æ ¸é…¸ï¼ŒåŒèºæ—‹ç»“æ„',
                    'RNA': 'æ ¸ç³–æ ¸é…¸ï¼Œå•é“¾ç»“æ„',
                    'ATP': 'è…ºè‹·ä¸‰ç£·é…¸ï¼ŒCâ‚â‚€Hâ‚â‚†Nâ‚…Oâ‚â‚ƒPâ‚ƒ',
                    'ADP': 'è…ºè‹·äºŒç£·é…¸ï¼ŒCâ‚â‚€Hâ‚â‚…Nâ‚…Oâ‚â‚€Pâ‚‚',
                    'å…‰åˆä½œç”¨': '6COâ‚‚ + 6Hâ‚‚O + å…‰èƒ½ â†’ Câ‚†Hâ‚â‚‚Oâ‚† + 6Oâ‚‚',
                    'å‘¼å¸ä½œç”¨': 'Câ‚†Hâ‚â‚‚Oâ‚† + 6Oâ‚‚ â†’ 6COâ‚‚ + 6Hâ‚‚O + ATP',
                    'è›‹ç™½è´¨åˆæˆ': 'DNA â†’ mRNA â†’ è›‹ç™½è´¨',
                    'ç§ç¾¤å¢é•¿': 'dN/dt = rN(1 - N/K)'
                };

                // æ±‡ç‡æ•°æ®
                this.exchangeRates = {
                    'USD': { 'CNY': 7.1776, 'EUR': 0.8234, 'GBP': 0.7456, 'JPY': 149.50, 'HKD': 7.8234 },
                    'CNY': { 'USD': 0.1393, 'EUR': 0.1147, 'GBP': 0.1039, 'JPY': 20.83, 'HKD': 1.0898 },
                    'EUR': { 'USD': 1.2143, 'CNY': 8.7234, 'GBP': 0.9054, 'JPY': 181.23, 'HKD': 9.5012 },
                    'GBP': { 'USD': 1.3416, 'CNY': 9.6321, 'EUR': 1.1045, 'JPY': 200.15, 'HKD': 10.4923 },
                    'JPY': { 'USD': 0.0067, 'CNY': 0.048, 'EUR': 0.0055, 'GBP': 0.005, 'HKD': 0.0523 },
                    'HKD': { 'USD': 0.1278, 'CNY': 0.9176, 'EUR': 0.1053, 'GBP': 0.0953, 'JPY': 19.11 }
                };

                // é£Ÿç‰©çƒ­é‡æ•°æ®åº“ï¼ˆæ¯100å…‹ï¼‰
                this.calorieDatabase = {
                    'ç±³é¥­': 116,
                    'é¢æ¡': 137,
                    'è‹¹æœ': 52,
                    'é¦™è•‰': 89,
                    'é¸¡è›‹': 155,
                    'ç‰›å¥¶': 54,
                    'é¢åŒ…': 265,
                    'åœŸè±†': 77,
                    'è¥¿çº¢æŸ¿': 18,
                    'é»„ç“œ': 16,
                    'é¸¡èƒ¸è‚‰': 165,
                    'ç‰›è‚‰': 250,
                    'çŒªè‚‰': 242,
                    'é±¼è‚‰': 206,
                    'ç™½èœ': 17,
                    'èƒ¡èåœ': 41,
                    'æ©™å­': 47,
                    'è‰è“': 32,
                    'è‘¡è„': 69,
                    'è¥¿ç“œ': 30
                };

                // ç”Ÿè‚–æ•°æ® - ä¿®æ­£é¡ºåºï¼Œ1900å¹´ä¸ºé¼ å¹´
                this.zodiacAnimals = ['é¼ ', 'ç‰›', 'è™', 'å…”', 'é¾™', 'è›‡', 'é©¬', 'ç¾Š', 'çŒ´', 'é¸¡', 'ç‹—', 'çŒª'];
                this.zodiacNames = {
                    'é¼ ': 'å­é¼ ', 'ç‰›': 'ä¸‘ç‰›', 'è™': 'å¯…è™', 'å…”': 'å¯å…”',
                    'é¾™': 'è¾°é¾™', 'è›‡': 'å·³è›‡', 'é©¬': 'åˆé©¬', 'ç¾Š': 'æœªç¾Š',
                    'çŒ´': 'ç”³çŒ´', 'é¸¡': 'é…‰é¸¡', 'ç‹—': 'æˆŒç‹—', 'çŒª': 'äº¥çŒª'
                };

                // æ˜Ÿåº§æ•°æ®
                this.constellations = [
                    { name: 'æ°´ç“¶åº§', start: [1, 20], end: [2, 18], element: 'é£è±¡', planet: 'å¤©ç‹æ˜Ÿ' },
                    { name: 'åŒé±¼åº§', start: [2, 19], end: [3, 20], element: 'æ°´è±¡', planet: 'æµ·ç‹æ˜Ÿ' },
                    { name: 'ç™½ç¾Šåº§', start: [3, 21], end: [4, 19], element: 'ç«è±¡', planet: 'ç«æ˜Ÿ' },
                    { name: 'é‡‘ç‰›åº§', start: [4, 20], end: [5, 20], element: 'åœŸè±¡', planet: 'é‡‘æ˜Ÿ' },
                    { name: 'åŒå­åº§', start: [5, 21], end: [6, 21], element: 'é£è±¡', planet: 'æ°´æ˜Ÿ' },
                    { name: 'å·¨èŸ¹åº§', start: [6, 22], end: [7, 22], element: 'æ°´è±¡', planet: 'æœˆäº®' },
                    { name: 'ç‹®å­åº§', start: [7, 23], end: [8, 22], element: 'ç«è±¡', planet: 'å¤ªé˜³' },
                    { name: 'å¤„å¥³åº§', start: [8, 23], end: [9, 22], element: 'åœŸè±¡', planet: 'æ°´æ˜Ÿ' },
                    { name: 'å¤©ç§¤åº§', start: [9, 23], end: [10, 23], element: 'é£è±¡', planet: 'é‡‘æ˜Ÿ' },
                    { name: 'å¤©èåº§', start: [10, 24], end: [11, 22], element: 'æ°´è±¡', planet: 'å†¥ç‹æ˜Ÿ' },
                    { name: 'å°„æ‰‹åº§', start: [11, 23], end: [12, 21], element: 'ç«è±¡', planet: 'æœ¨æ˜Ÿ' },
                    { name: 'æ‘©ç¾¯åº§', start: [12, 22], end: [1, 19], element: 'åœŸè±¡', planet: 'åœŸæ˜Ÿ' }
                ];

                // èŠ‚å‡æ—¥æ•°æ®
                this.holidays = {
                    2024: {
                        'æ˜¥èŠ‚': '2024-02-10',
                        'æ¸…æ˜èŠ‚': '2024-04-05',
                        'åŠ³åŠ¨èŠ‚': '2024-05-01',
                        'ç«¯åˆèŠ‚': '2024-06-10',
                        'ä¸­ç§‹èŠ‚': '2024-09-17',
                        'å›½åº†èŠ‚': '2024-10-01'
                    },
                    2025: {
                        'æ˜¥èŠ‚': '2025-01-29',
                        'æ¸…æ˜èŠ‚': '2025-04-05',
                        'åŠ³åŠ¨èŠ‚': '2025-05-01',
                        'ç«¯åˆèŠ‚': '2025-05-31',
                        'ä¸­ç§‹èŠ‚': '2025-10-06',
                        'å›½åº†èŠ‚': '2025-10-01'
                    }
                };

                // å•ä½è½¬æ¢ç³»æ•°
                this.conversionFactors = {
                    // é•¿åº¦è½¬æ¢ï¼ˆè½¬ä¸ºç±³ï¼‰
                    length: {
                        'å˜ç±³': 0.01, 'cm': 0.01,
                        'æ¯«ç±³': 0.001, 'mm': 0.001,
                        'ç±³': 1, 'm': 1,
                        'åƒç±³': 1000, 'km': 1000,
                        'è‹±å°º': 0.3048, 'ft': 0.3048,
                        'è‹±å¯¸': 0.0254, 'in': 0.0254,
                        'ç ': 0.9144, 'yard': 0.9144
                    },
                    // é‡é‡è½¬æ¢ï¼ˆè½¬ä¸ºå…‹ï¼‰
                    weight: {
                        'å…‹': 1, 'g': 1,
                        'åƒå…‹': 1000, 'å…¬æ–¤': 1000, 'kg': 1000,
                        'å¨': 1000000, 't': 1000000,
                        'ç£…': 453.592, 'lb': 453.592
                    },
                    // é¢ç§¯è½¬æ¢ï¼ˆè½¬ä¸ºå¹³æ–¹ç±³ï¼‰
                    area: {
                        'å¹³æ–¹ç±³': 1, 'ã¡': 1,
                        'å¹³æ–¹åƒç±³': 1000000, 'kmÂ²': 1000000,
                        'äº©': 666.67,
                        'è‹±äº©': 4046.86
                    },
                    // ä½“ç§¯è½¬æ¢ï¼ˆè½¬ä¸ºå‡ï¼‰
                    volume: {
                        'å‡': 1, 'l': 1,
                        'æ¯«å‡': 0.001, 'ml': 0.001,
                        'åŠ ä»‘': 3.78541, 'gal': 3.78541
                    },
                    // èƒ½é‡è½¬æ¢ï¼ˆè½¬ä¸ºç„¦è€³ï¼‰
                    energy: {
                        'ç„¦è€³': 1, 'J': 1,
                        'åƒç„¦': 1000, 'kJ': 1000,
                        'å¡è·¯é‡Œ': 4.184, 'cal': 4.184,
                        'åƒå¡': 4184, 'kcal': 4184,
                        'ç“¦æ—¶': 3600, 'Wh': 3600,
                        'åƒç“¦æ—¶': 3600000, 'kWh': 3600000
                    },
                    // åŠŸç‡è½¬æ¢ï¼ˆè½¬ä¸ºç“¦ï¼‰
                    power: {
                        'ç“¦': 1, 'W': 1,
                        'åƒç“¦': 1000, 'kW': 1000,
                        'å…†ç“¦': 1000000, 'MW': 1000000,
                        'é©¬åŠ›': 745.7, 'hp': 745.7
                    },
                    // å‹åŠ›è½¬æ¢ï¼ˆè½¬ä¸ºå¸•æ–¯å¡ï¼‰
                    pressure: {
                        'å¸•': 1, 'Pa': 1,
                        'åƒå¸•': 1000, 'kPa': 1000,
                        'å…†å¸•': 1000000, 'MPa': 1000000,
                        'æ¯«ç±³æ±æŸ±': 133.322, 'mmHg': 133.322,
                        'å¤§æ°”å‹': 101325, 'atm': 101325,
                        'bar': 100000
                    }
                };
            }

            async process(input) {
                const cleanInput = this.preprocessInput(input);
                console.log(`[DEBUG] é¢„å¤„ç†åçš„è¾“å…¥: "${cleanInput}"`);
                
                if (this.cache.has(cleanInput)) {
                    console.log(`[DEBUG] ç¼“å­˜å‘½ä¸­`);
                    return this.cache.get(cleanInput);
                }

                console.log(`[DEBUG] å¼€å§‹åŒ¹é…è§„åˆ™ï¼Œå…±${this.rules.length}ä¸ªè§„åˆ™`);
                for (const rule of this.rules) {
                    console.log(`[DEBUG] æ£€æŸ¥è§„åˆ™: ${rule.category}, ä¼˜å…ˆçº§: ${rule.priority}`);
                    for (let i = 0; i < rule.patterns.length; i++) {
                        const pattern = rule.patterns[i];
                        console.log(`[DEBUG] æµ‹è¯•æ¨¡å¼ ${i + 1}/${rule.patterns.length}: ${pattern}`);
                        const match = cleanInput.match(pattern);
                        if (match) {
                            console.log(`[DEBUG] æ¨¡å¼åŒ¹é…æˆåŠŸï¼åŒ¹é…ç»“æœ:`, match);
                            try {
                                const result = await rule.handler(match, cleanInput);
                                if (result) {
                                    result.category = rule.category; // æ·»åŠ å“ç±»ä¿¡æ¯
                                    this.cache.set(cleanInput, result);
                                    console.log(`[DEBUG] å¤„ç†å®Œæˆï¼Œè¿”å›ç»“æœ:`, result);
                                    return result;
                                } else {
                                    console.log(`[DEBUG] å¤„ç†å™¨è¿”å›null`);
                                }
                            } catch (error) {
                                console.error(`å¤„ç†è§„åˆ™ ${rule.category} æ—¶å‡ºé”™:`, error);
                            }
                        }
                    }
                }

                console.log(`[DEBUG] æ‰€æœ‰è§„åˆ™éƒ½æœªåŒ¹é…`);
                return null;
            }

            preprocessInput(input) {
                return input.trim()
                    .replace(/\s+/g, ' ')
                    .replace(/[ï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š]/g, '');
            }

            handleMathCalculation(match, input) {
                try {
                    // å¤„ç†æ‰“æŠ˜è®¡ç®—
                    const discountMatch = input.match(/^(\d+(?:\.\d+)?)\s*æ‰“\s*(\d+(?:\.\d+)?)\s*æŠ˜$/);
                    if (discountMatch) {
                        const [, price, discount] = discountMatch;
                        const finalPrice = (parseFloat(price) * parseFloat(discount) / 10).toFixed(1);
                        return { type: 'calculation', result: finalPrice };
                    }

                    const originalDiscountMatch = input.match(/^åŸä»·\s*(\d+(?:\.\d+)?)\s*æ‰“\s*(\d+(?:\.\d+)?)\s*æŠ˜$/);
                    if (originalDiscountMatch) {
                        const [, price, discount] = originalDiscountMatch;
                        const finalPrice = (parseFloat(price) * parseFloat(discount) / 10).toFixed(1);
                        return { type: 'calculation', result: finalPrice };
                    }

                    // å¤„ç†ç™¾åˆ†æ¯”è®¡ç®—
                    const percentMatch1 = input.match(/^(\d+(?:\.\d+)?)\s*çš„\s*(\d+(?:\.\d+)?)\s*%$/);
                    if (percentMatch1) {
                        const [, base, percent] = percentMatch1;
                        const result = (parseFloat(base) * parseFloat(percent) / 100).toFixed(2);
                        return { type: 'calculation', result: result };
                    }

                    const percentMatch2 = input.match(/^(\d+(?:\.\d+)?)\s*%\s*çš„\s*(\d+(?:\.\d+)?)$/);
                    if (percentMatch2) {
                        const [, percent, base] = percentMatch2;
                        const result = (parseFloat(base) * parseFloat(percent) / 100).toFixed(2);
                        return { type: 'calculation', result: result };
                    }

                    // å¤„ç†åˆ†æœŸè®¡ç®—
                    const installmentMatch = input.match(/^(\d+(?:\.\d+)?)\s*åˆ†æœŸ\s*(\d+)\s*æœŸ$/);
                    if (installmentMatch) {
                        const [, total, periods] = installmentMatch;
                        const monthly = (parseFloat(total) / parseInt(periods)).toFixed(2);
                        return { type: 'calculation', result: `æ¯æœŸ${monthly}å…ƒ` };
                    }

                    let expression = input;
                    
                    const replacements = {
                        'åŠ ': '+',
                        'å‡': '-',
                        'ä¹˜': '*',
                        'é™¤': '/',
                        'çš„å¹³æ–¹æ ¹': 'sqrt',
                        'çš„ç«‹æ–¹æ ¹': 'cbrt',
                        'çš„å¹³æ–¹': 'square',
                        'çš„ç«‹æ–¹': 'cube'
                    };

                    for (const [chinese, symbol] of Object.entries(replacements)) {
                        expression = expression.replace(new RegExp(chinese, 'g'), symbol);
                    }

                    if (expression.includes('sqrt')) {
                        const num = parseFloat(expression.replace(/.*?(\d+(?:\.\d+)?).*/, '$1'));
                        const result = Math.sqrt(num);
                        return { type: 'calculation', result: `= ${result}` };
                    }

                    if (expression.includes('cbrt')) {
                        const num = parseFloat(expression.replace(/.*?(\d+(?:\.\d+)?).*/, '$1'));
                        const result = Math.cbrt(num);
                        return { type: 'calculation', result: `= ${result.toFixed(4)}` };
                    }

                    if (expression.includes('square')) {
                        const num = parseFloat(expression.replace(/.*?(\d+(?:\.\d+)?).*/, '$1'));
                        const result = Math.pow(num, 2);
                        return { type: 'calculation', result: `= ${result}` };
                    }

                    if (expression.includes('cube')) {
                        const num = parseFloat(expression.replace(/.*?(\d+(?:\.\d+)?).*/, '$1'));
                        const result = Math.pow(num, 3);
                        return { type: 'calculation', result: `= ${result}` };
                    }

                    // å¤„ç†é˜¶ä¹˜
                    const factorialMatch = input.match(/^(\d+(?:\.\d+)?)\s*çš„?\s*(é˜¶ä¹˜|!)$/);
                    if (factorialMatch) {
                        const num = parseInt(factorialMatch[1]);
                        if (num > 20) return { type: 'calculation', result: 'æ•°å­—å¤ªå¤§ï¼Œæ— æ³•è®¡ç®—é˜¶ä¹˜' };
                        let result = 1;
                        for (let i = 2; i <= num; i++) {
                            result *= i;
                        }
                        return { type: 'calculation', result: `= ${result}` };
                    }

                    // å¤„ç†ä¸‰è§’å‡½æ•°
                    const trigMatch = input.match(/^(sin|cos|tan|sinh|cosh|tanh)\s*(\d+(?:\.\d+)?)$/);
                    if (trigMatch) {
                        const [, func, num] = trigMatch;
                        const radians = parseFloat(num) * Math.PI / 180; // è½¬æ¢ä¸ºå¼§åº¦
                        let result;
                        switch (func) {
                            case 'sin': result = Math.sin(radians); break;
                            case 'cos': result = Math.cos(radians); break;
                            case 'tan': result = Math.tan(radians); break;
                            case 'sinh': result = Math.sinh(radians); break;
                            case 'cosh': result = Math.cosh(radians); break;
                            case 'tanh': result = Math.tanh(radians); break;
                        }
                        return { type: 'calculation', result: `= ${result.toFixed(6)}` };
                    }

                    // å¤„ç†å¯¹æ•°
                    const logMatch = input.match(/^(log|ln|lg)\s*(\d+(?:\.\d+)?)$/);
                    if (logMatch) {
                        const [, func, num] = logMatch;
                        const value = parseFloat(num);
                        if (value <= 0) return { type: 'calculation', result: 'å¯¹æ•°çš„çœŸæ•°å¿…é¡»å¤§äº0' };
                        let result;
                        switch (func) {
                            case 'ln': result = Math.log(value); break;
                            case 'lg': result = Math.log10(value); break;
                            case 'log': result = Math.log10(value); break; // é»˜è®¤ä¸ºå¸¸ç”¨å¯¹æ•°
                        }
                        return { type: 'calculation', result: `= ${result.toFixed(6)}` };
                    }

                    // å¤„ç†æŒ‡æ•°
                    const powerMatch = input.match(/^(\d+(?:\.\d+)?)\s*çš„\s*(\d+(?:\.\d+)?)\s*æ¬¡æ–¹$/);
                    if (powerMatch) {
                        const [, base, exp] = powerMatch;
                        const result = Math.pow(parseFloat(base), parseFloat(exp));
                        return { type: 'calculation', result: `= ${result}` };
                    }

                    // å¤„ç†eçš„æŒ‡æ•°
                    const expMatch = input.match(/^e\s*çš„\s*(\d+(?:\.\d+)?)\s*æ¬¡æ–¹$/);
                    if (expMatch) {
                        const exp = parseFloat(expMatch[1]);
                        const result = Math.exp(exp);
                        return { type: 'calculation', result: `= ${result.toFixed(6)}` };
                    }

                    // å¤„ç†è¿›åˆ¶è½¬æ¢
                    const baseMatch = input.match(/^(\d+)\s*è¿›åˆ¶è½¬\s*(\d+)\s*è¿›åˆ¶\s*(\d+)$/);
                    if (baseMatch) {
                        const [, fromBase, toBase, number] = baseMatch;
                        const from = parseInt(fromBase);
                        const to = parseInt(toBase);
                        if (from < 2 || from > 36 || to < 2 || to > 36) {
                            return { type: 'calculation', result: 'è¿›åˆ¶èŒƒå›´å¿…é¡»åœ¨2-36ä¹‹é—´' };
                        }
                        try {
                            const decimal = parseInt(number, from);
                            const result = decimal.toString(to).toUpperCase();
                            return { type: 'calculation', result: `= ${result}` };
                        } catch (e) {
                            return { type: 'calculation', result: 'è¿›åˆ¶è½¬æ¢é”™è¯¯' };
                        }
                    }

                    const basicMatch = expression.match(/^(\d+(?:\.\d+)?)\s*([+\-*/])\s*(\d+(?:\.\d+)?)$/);
                    if (basicMatch) {
                        const [, num1, operator, num2] = basicMatch;
                        const a = parseFloat(num1);
                        const b = parseFloat(num2);
                        
                        let result;
                        switch (operator) {
                            case '+': result = a + b; break;
                            case '-': result = a - b; break;
                            case '*': result = a * b; break;
                            case '/': result = b !== 0 ? a / b : 'é™¤æ•°ä¸èƒ½ä¸º0'; break;
                        }
                        
                        return { type: 'calculation', result: `= ${result}` };
                    }
                } catch (error) {
                    return { type: 'error', result: 'è®¡ç®—é”™è¯¯' };
                }
                
                return null;
            }

            handleDateCalculation(match, input) {
                const now = new Date();
                let targetDate = new Date(now);

                // å¤„ç†ç›¸å¯¹æ—¥æœŸ
                const relativeMatch = input.match(/^(\d+)\s*(å¤©|æ—¥|å‘¨|æœˆ|å¹´)\s*(å|å‰|å†…)$/);
                if (relativeMatch) {
                    const [, amount, unit, direction] = relativeMatch;
                    const num = parseInt(amount);
                    
                    if (direction === 'å†…') {
                        return { type: 'date', result: `ä»ä»Šå¤©å¼€å§‹${num}${unit}å†…` };
                    }
                    
                    const multiplier = direction === 'å' ? 1 : -1;

                    switch (unit) {
                        case 'å¤©':
                        case 'æ—¥':
                            targetDate.setDate(targetDate.getDate() + num * multiplier);
                            break;
                        case 'å‘¨':
                            targetDate.setDate(targetDate.getDate() + num * 7 * multiplier);
                            break;
                        case 'æœˆ':
                            targetDate.setMonth(targetDate.getMonth() + num * multiplier);
                            break;
                        case 'å¹´':
                            targetDate.setFullYear(targetDate.getFullYear() + num * multiplier);
                            break;
                    }

                    const year = targetDate.getFullYear();
                    const month = targetDate.getMonth() + 1;
                    const day = targetDate.getDate();
                    
                    // å¦‚æœæ—¶é—´è·¨åº¦è¶…è¿‡1å¹´ï¼Œæ˜¾ç¤ºå¹´ä»½
                    const currentYear = now.getFullYear();
                    if (year !== currentYear) {
                        return { type: 'date', result: `ï¼ˆ${year}å¹´${month}æœˆ${day}æ—¥ï¼‰` };
                    } else {
                        return { type: 'date', result: `ï¼ˆ${month}æœˆ${day}æ—¥ï¼‰` };
                    }
                }

                // å¤„ç†å¿«é€Ÿæ—¥æœŸ
                const specialDates = {
                    'ä»Šå¤©': 0,
                    'æ˜å¤©': 1,
                    'åå¤©': 2,
                    'å¤§åå¤©': 3,
                    'æ˜¨å¤©': -1,
                    'å‰å¤©': -2
                };

                if (specialDates.hasOwnProperty(input)) {
                    targetDate.setDate(targetDate.getDate() + specialDates[input]);
                    const month = targetDate.getMonth() + 1;
                    const day = targetDate.getDate();
                    const weekDay = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][targetDate.getDay()];
                    return { type: 'date', result: `ï¼ˆ${month}æœˆ${day}æ—¥ å‘¨${weekDay}ï¼‰` };
                }

                // å¤„ç†å…·ä½“æ—¥æœŸ
                const specificMatch = input.match(/^(\d+)\s*æœˆ\s*(\d+)\s*æ—¥$/);
                if (specificMatch) {
                    const [, month, day] = specificMatch;
                    const targetDate = new Date(now.getFullYear(), parseInt(month) - 1, parseInt(day));
                    const weekDay = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][targetDate.getDay()];
                    return { type: 'date', result: `${month}æœˆ${day}æ—¥ å‘¨${weekDay}` };
                }

                // å¤„ç†æœ¬å‘¨æŸå¤©
                const thisWeekMatch = input.match(/^æœ¬å‘¨\s*(ä¸€|äºŒ|ä¸‰|å››|äº”|å…­|æ—¥)$/);
                if (thisWeekMatch) {
                    const [, dayName] = thisWeekMatch;
                    const dayMap = { 'ä¸€': 1, 'äºŒ': 2, 'ä¸‰': 3, 'å››': 4, 'äº”': 5, 'å…­': 6, 'æ—¥': 0 };
                    const targetDay = dayMap[dayName];
                    const currentDay = now.getDay();
                    const diff = targetDay - currentDay;
                    const targetDate = new Date(now);
                    targetDate.setDate(now.getDate() + diff);
                    
                    const month = targetDate.getMonth() + 1;
                    const day = targetDate.getDate();
                    return { type: 'date', result: `${month}æœˆ${day}æ—¥` };
                }

                // å¤„ç†å†œå†æŸ¥è¯¢
                const lunarMatch = input.match(/^.*?(ä»Šå¤©|æ˜å¤©|æ˜¨å¤©)\s*(å†œå†|é˜´å†)[ï¼Ÿ?]?$/);
                if (lunarMatch) {
                    const [, dayType] = lunarMatch;
                    let targetDate = new Date();
                    
                    switch (dayType) {
                        case 'æ˜å¤©': targetDate.setDate(targetDate.getDate() + 1); break;
                        case 'æ˜¨å¤©': targetDate.setDate(targetDate.getDate() - 1); break;
                    }
                    
                    const lunarDate = this.getLunarDate(targetDate);
                    return { type: 'date', result: `å†œå†${lunarDate}` };
                }

                // å¤„ç†èŠ‚å‡æ—¥æŸ¥è¯¢
                const holidayMatch = input.match(/^.*?(ä»Šå¤©|æ˜å¤©|æ˜¨å¤©)\s*(ä»€ä¹ˆèŠ‚|èŠ‚æ—¥|å‡æœŸ)[ï¼Ÿ?]?$/);
                if (holidayMatch) {
                    const [, dayType] = holidayMatch;
                    let targetDate = new Date();
                    
                    switch (dayType) {
                        case 'æ˜å¤©': targetDate.setDate(targetDate.getDate() + 1); break;
                        case 'æ˜¨å¤©': targetDate.setDate(targetDate.getDate() - 1); break;
                    }
                    
                    const holiday = this.getHoliday(targetDate);
                    if (holiday) {
                        return { type: 'date', result: holiday };
                    } else {
                        return { type: 'date', result: 'éæ³•å®šèŠ‚å‡æ—¥' };
                    }
                }

                // å¤„ç†ä¸‹ä¸ªèŠ‚å‡æ—¥æŸ¥è¯¢
                const nextHolidayMatch = input.match(/^.*?(ä¸‹ä¸ª|ä¸‹ä¸€ä¸ª|ä¸‹æ¬¡)\s*(èŠ‚æ—¥|å‡æœŸ|èŠ‚)[ï¼Ÿ?]?$/);
                if (nextHolidayMatch) {
                    const nextHoliday = this.getNextHoliday(now);
                    if (nextHoliday) {
                        const { name, date, daysLeft } = nextHoliday;
                        return { type: 'date', result: `${name}ï¼ˆ${date}ï¼Œè¿˜æœ‰${daysLeft}å¤©ï¼‰` };
                    }
                }

                // å¤„ç†è·ç¦»æ—¥æœŸè®¡ç®—
                const distanceMatch = input.match(/^.*?è·ç¦»\s*(\d+)\s*æœˆ\s*(\d+)\s*æ—¥\s*(è¿˜æœ‰|å·²è¿‡|è¿˜å‰©)$/);
                if (distanceMatch) {
                    const [, month, day, type] = distanceMatch;
                    const targetDate = new Date(now.getFullYear(), parseInt(month) - 1, parseInt(day));
                    const diffTime = targetDate - now;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (type === 'è¿˜æœ‰' || type === 'è¿˜å‰©') {
                        return { type: 'date', result: diffDays > 0 ? `è¿˜æœ‰${diffDays}å¤©` : `å·²è¿‡å»${Math.abs(diffDays)}å¤©` };
                    } else {
                        return { type: 'date', result: diffDays < 0 ? `å·²è¿‡å»${Math.abs(diffDays)}å¤©` : `è¿˜æœ‰${diffDays}å¤©` };
                    }
                }

                return null;
            }

            handleTimezoneQuery(match, input) {
                const cityMatch = input.match(/^([\u4e00-\u9fa5]+|[A-Za-z]+)\s*æ—¶é—´$/);
                if (cityMatch) {
                    const city = cityMatch[1];
                    const timezone = this.timezoneMap[city];
                    
                    if (timezone) {
                        const time = new Intl.DateTimeFormat('zh-CN', {
                            timeZone: timezone,
                            hour: '2-digit',
                            minute: '2-digit',
                            hour12: false
                        }).format(new Date());
                        
                        return { type: 'timezone', result: `ï¼ˆ${time}ï¼‰` };
                    }
                }

                // å¤„ç†"ç°åœ¨XXæ—¶é—´"æ ¼å¼
                const nowCityMatch = input.match(/^ç°åœ¨\s*([\u4e00-\u9fa5]+|[A-Za-z]+)\s*(å‡ ç‚¹|æ—¶é—´)$/);
                if (nowCityMatch) {
                    const city = nowCityMatch[1];
                    const timezone = this.timezoneMap[city];
                    
                    if (timezone) {
                        const time = new Intl.DateTimeFormat('zh-CN', {
                            timeZone: timezone,
                            hour: '2-digit',
                            minute: '2-digit',
                            hour12: false
                        }).format(new Date());
                        
                        return { type: 'timezone', result: `${time}` };
                    }
                }

                // å¤„ç†"XXç°åœ¨å‡ ç‚¹"æ ¼å¼
                const cityNowMatch = input.match(/^([\u4e00-\u9fa5]+|[A-Za-z]+)\s*ç°åœ¨\s*(å‡ ç‚¹|æ—¶é—´)$/);
                if (cityNowMatch) {
                    const city = cityNowMatch[1];
                    const timezone = this.timezoneMap[city];
                    
                    if (timezone) {
                        const time = new Intl.DateTimeFormat('zh-CN', {
                            timeZone: timezone,
                            hour: '2-digit',
                            minute: '2-digit',
                            hour12: false
                        }).format(new Date());
                        
                        return { type: 'timezone', result: time };
                    }
                }

                return null;
            }

            handleUnitConversion(match, input) {
                // æ¸©åº¦è½¬æ¢
                const tempMatch = input.match(/^(\d+(?:\.\d+)?)\s*(æ‘„æ°åº¦|åæ°åº¦|â„ƒ|â„‰)/);
                if (tempMatch) {
                    const [, value, unit] = tempMatch;
                    const num = parseFloat(value);

                    if (unit === 'æ‘„æ°åº¦' || unit === 'â„ƒ') {
                        const fahrenheit = (num * 9/5 + 32).toFixed(1);
                        return { type: 'conversion', result: `${fahrenheit}åæ°åº¦` };
                    } else if (unit === 'åæ°åº¦' || unit === 'â„‰') {
                        const celsius = ((num - 32) * 5/9).toFixed(1);
                        return { type: 'conversion', result: `${celsius}æ‘„æ°åº¦` };
                    }
                }

                // é•¿åº¦è½¬æ¢
                const lengthMatch = input.match(/^(\d+(?:\.\d+)?)\s*(ç±³|å˜ç±³|æ¯«ç±³|åƒç±³|è‹±å°º|è‹±å¯¸|ç |m|cm|mm|km|ft|in|yard)/);
                if (lengthMatch) {
                    const [, value, unit] = lengthMatch;
                    const num = parseFloat(value);
                    const factor = this.conversionFactors.length[unit];
                    
                    if (factor) {
                        const meters = num * factor;
                        if (unit === 'ç±³' || unit === 'm') {
                            const feet = (meters * 3.28084).toFixed(2);
                            const cm = (meters * 100).toFixed(0);
                            return { type: 'conversion', result: `${feet}è‹±å°º / ${cm}å˜ç±³` };
                        } else if (unit === 'å˜ç±³' || unit === 'cm') {
                            const inches = (meters * 39.3701).toFixed(2);
                            return { type: 'conversion', result: `${inches}è‹±å¯¸` };
                        } else if (unit === 'è‹±å°º' || unit === 'ft') {
                            const meters_result = (meters).toFixed(2);
                            return { type: 'conversion', result: `${meters_result}ç±³` };
                        }
                    }
                }

                // é‡é‡è½¬æ¢
                const weightMatch = input.match(/^(\d+(?:\.\d+)?)\s*(å…¬æ–¤|åƒå…‹|å…‹|ç£…|å¨|kg|g|lb|t)/);
                if (weightMatch) {
                    const [, value, unit] = weightMatch;
                    const num = parseFloat(value);
                    const factor = this.conversionFactors.weight[unit];
                    
                    if (factor) {
                        const grams = num * factor;
                        if (unit === 'å…¬æ–¤' || unit === 'åƒå…‹' || unit === 'kg') {
                            const pounds = (grams / 453.592).toFixed(2);
                            return { type: 'conversion', result: `${pounds}ç£…` };
                        } else if (unit === 'ç£…' || unit === 'lb') {
                            const kg = (grams / 1000).toFixed(2);
                            return { type: 'conversion', result: `${kg}å…¬æ–¤` };
                        } else if (unit === 'å…‹' || unit === 'g') {
                            const kg = (grams / 1000).toFixed(3);
                            return { type: 'conversion', result: `${kg}å…¬æ–¤` };
                        }
                    }
                }

                // é¢ç§¯è½¬æ¢
                const areaMatch = input.match(/^(\d+(?:\.\d+)?)\s*(å¹³æ–¹ç±³|å¹³æ–¹åƒç±³|äº©|è‹±äº©|ã¡|kmÂ²)/);
                if (areaMatch) {
                    const [, value, unit] = areaMatch;
                    const num = parseFloat(value);
                    const factor = this.conversionFactors.area[unit];
                    
                    if (factor) {
                        const sqm = num * factor;
                        if (unit === 'å¹³æ–¹ç±³' || unit === 'ã¡') {
                            const acres = (sqm / 4046.86).toFixed(4);
                            return { type: 'conversion', result: `${acres}è‹±äº©` };
                        } else if (unit === 'äº©') {
                            const sqm_result = (sqm).toFixed(0);
                            return { type: 'conversion', result: `${sqm_result}å¹³æ–¹ç±³` };
                        }
                    }
                }

                // ä½“ç§¯è½¬æ¢
                const volumeMatch = input.match(/^(\d+(?:\.\d+)?)\s*(å‡|æ¯«å‡|åŠ ä»‘|l|ml|gal)/);
                if (volumeMatch) {
                    const [, value, unit] = volumeMatch;
                    const num = parseFloat(value);
                    const factor = this.conversionFactors.volume[unit];
                    
                    if (factor) {
                        const liters = num * factor;
                        if (unit === 'å‡' || unit === 'l') {
                            const gallons = (liters / 3.78541).toFixed(2);
                            return { type: 'conversion', result: `${gallons}åŠ ä»‘` };
                        } else if (unit === 'æ¯«å‡' || unit === 'ml') {
                            const liters_result = (liters).toFixed(3);
                            return { type: 'conversion', result: `${liters_result}å‡` };
                        }
                    }
                }

                // èƒ½é‡è½¬æ¢
                const energyMatch = input.match(/^(\d+(?:\.\d+)?)\s*(åƒç„¦|ç„¦è€³|å¡è·¯é‡Œ|åƒå¡|ç“¦æ—¶|åƒç“¦æ—¶|kJ|J|cal|kcal|Wh|kWh)/);
                if (energyMatch) {
                    const [, value, unit] = energyMatch;
                    const num = parseFloat(value);
                    const factor = this.conversionFactors.energy[unit];
                    
                    if (factor) {
                        const joules = num * factor;
                        if (unit === 'ç„¦è€³' || unit === 'J') {
                            const kj = (joules / 1000).toFixed(3);
                            const cal = (joules / 4.184).toFixed(2);
                            return { type: 'conversion', result: `${kj}åƒç„¦ / ${cal}å¡è·¯é‡Œ` };
                        } else if (unit === 'åƒç„¦' || unit === 'kJ') {
                            const kcal = (joules / 4184).toFixed(3);
                            return { type: 'conversion', result: `${kcal}åƒå¡` };
                        } else if (unit === 'å¡è·¯é‡Œ' || unit === 'cal') {
                            const kj = (joules / 1000).toFixed(3);
                            return { type: 'conversion', result: `${kj}åƒç„¦` };
                        } else if (unit === 'åƒå¡' || unit === 'kcal') {
                            const kj = (joules / 1000).toFixed(1);
                            return { type: 'conversion', result: `${kj}åƒç„¦` };
                        } else if (unit === 'åƒç“¦æ—¶' || unit === 'kWh') {
                            const mj = (joules / 1000000).toFixed(1);
                            return { type: 'conversion', result: `${mj}å…†ç„¦` };
                        }
                    }
                }

                // åŠŸç‡è½¬æ¢
                const powerMatch = input.match(/^(\d+(?:\.\d+)?)\s*(ç“¦|åƒç“¦|é©¬åŠ›|å…†ç“¦|W|kW|MW|hp)/);
                if (powerMatch) {
                    const [, value, unit] = powerMatch;
                    const num = parseFloat(value);
                    const factor = this.conversionFactors.power[unit];
                    
                    if (factor) {
                        const watts = num * factor;
                        if (unit === 'ç“¦' || unit === 'W') {
                            const kw = (watts / 1000).toFixed(3);
                            const hp = (watts / 745.7).toFixed(3);
                            return { type: 'conversion', result: `${kw}åƒç“¦ / ${hp}é©¬åŠ›` };
                        } else if (unit === 'åƒç“¦' || unit === 'kW') {
                            const hp = (watts / 745.7).toFixed(2);
                            return { type: 'conversion', result: `${hp}é©¬åŠ›` };
                        } else if (unit === 'é©¬åŠ›' || unit === 'hp') {
                            const kw = (watts / 1000).toFixed(2);
                            return { type: 'conversion', result: `${kw}åƒç“¦` };
                        } else if (unit === 'å…†ç“¦' || unit === 'MW') {
                            const hp = (watts / 745.7).toFixed(0);
                            return { type: 'conversion', result: `${hp}é©¬åŠ›` };
                        }
                    }
                }

                // å‹åŠ›è½¬æ¢
                const pressureMatch = input.match(/^(\d+(?:\.\d+)?)\s*(å¸•|åƒå¸•|å…†å¸•|æ¯«ç±³æ±æŸ±|å¤§æ°”å‹|Pa|kPa|MPa|mmHg|atm|bar)/);
                if (pressureMatch) {
                    const [, value, unit] = pressureMatch;
                    const num = parseFloat(value);
                    const factor = this.conversionFactors.pressure[unit];
                    
                    if (factor) {
                        const pascals = num * factor;
                        if (unit === 'å¸•' || unit === 'Pa') {
                            const kpa = (pascals / 1000).toFixed(3);
                            const mmhg = (pascals / 133.322).toFixed(2);
                            return { type: 'conversion', result: `${kpa}åƒå¸• / ${mmhg}æ¯«ç±³æ±æŸ±` };
                        } else if (unit === 'åƒå¸•' || unit === 'kPa') {
                            const atm = (pascals / 101325).toFixed(4);
                            return { type: 'conversion', result: `${atm}å¤§æ°”å‹` };
                        } else if (unit === 'å¤§æ°”å‹' || unit === 'atm') {
                            const kpa = (pascals / 1000).toFixed(1);
                            return { type: 'conversion', result: `${kpa}åƒå¸•` };
                        } else if (unit === 'æ¯«ç±³æ±æŸ±' || unit === 'mmHg') {
                            const kpa = (pascals / 1000).toFixed(2);
                            return { type: 'conversion', result: `${kpa}åƒå¸•` };
                        }
                    }
                }

                return null;
            }

            async handleCurrencyConversion(match, input) {
                const currencyMatch = input.match(/^(\d+(?:\.\d+)?)\s*(ç¾å…ƒ|äººæ°‘å¸|æ¬§å…ƒ|è‹±é•‘|æ—¥å…ƒ|æ¸¯å¸|USD|CNY|EUR|GBP|JPY|HKD)$/);
                if (currencyMatch) {
                    const [, amount, currency] = currencyMatch;
                    const num = parseFloat(amount);

                    const currencyMap = {
                        'ç¾å…ƒ': 'USD',
                        'äººæ°‘å¸': 'CNY', 
                        'æ¬§å…ƒ': 'EUR',
                        'è‹±é•‘': 'GBP',
                        'æ—¥å…ƒ': 'JPY',
                        'æ¸¯å¸': 'HKD'
                    };

                    const fromCurrency = currencyMap[currency] || currency;
                    
                    // å°è¯•è·å–å®æ—¶æ±‡ç‡
                    try {
                        const realTimeRates = await this.getRealTimeExchangeRates(fromCurrency);
                        if (realTimeRates) {
                            if (fromCurrency === 'USD') {
                                const cnyAmount = (num * realTimeRates.CNY).toFixed(4);
                                return { type: 'currency', result: `ï¼ˆ${cnyAmount} äººæ°‘å¸ï¼‰` };
                            } else if (fromCurrency === 'CNY') {
                                const usdAmount = (num / realTimeRates.USD).toFixed(4);
                                return { type: 'currency', result: `ï¼ˆ${usdAmount} ç¾å…ƒï¼‰` };
                            } else if (fromCurrency === 'EUR') {
                                const cnyAmount = (num * realTimeRates.CNY).toFixed(4);
                                return { type: 'currency', result: `ï¼ˆ${cnyAmount} äººæ°‘å¸ï¼‰` };
                            } else if (fromCurrency === 'GBP') {
                                const cnyAmount = (num * realTimeRates.CNY).toFixed(4);
                                return { type: 'currency', result: `ï¼ˆ${cnyAmount} äººæ°‘å¸ï¼‰` };
                            } else if (fromCurrency === 'JPY') {
                                const cnyAmount = (num * realTimeRates.CNY).toFixed(4);
                                return { type: 'currency', result: `ï¼ˆ${cnyAmount} äººæ°‘å¸ï¼‰` };
                            } else if (fromCurrency === 'HKD') {
                                const cnyAmount = (num * realTimeRates.CNY).toFixed(4);
                                return { type: 'currency', result: `ï¼ˆ${cnyAmount} äººæ°‘å¸ï¼‰` };
                            }
                        }
                    } catch (error) {
                        console.log('å®æ—¶æ±‡ç‡è·å–å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ±‡ç‡:', error);
                    }
                    
                    // å¦‚æœå®æ—¶æ±‡ç‡è·å–å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ±‡ç‡
                    if (fromCurrency === 'USD') {
                        const cnyAmount = (num * this.exchangeRates.USD.CNY).toFixed(4);
                        return { type: 'currency', result: `ï¼ˆ${cnyAmount} äººæ°‘å¸ï¼‰` };
                    } else if (fromCurrency === 'CNY') {
                        const usdAmount = (num * this.exchangeRates.CNY.USD).toFixed(4);
                        return { type: 'currency', result: `ï¼ˆ${usdAmount} ç¾å…ƒï¼‰` };
                    } else if (fromCurrency === 'EUR') {
                        const cnyAmount = (num * this.exchangeRates.EUR.CNY).toFixed(4);
                        return { type: 'currency', result: `ï¼ˆ${cnyAmount} äººæ°‘å¸ï¼‰` };
                    } else if (fromCurrency === 'GBP') {
                        const cnyAmount = (num * this.exchangeRates.GBP.CNY).toFixed(4);
                        return { type: 'currency', result: `ï¼ˆ${cnyAmount} äººæ°‘å¸ï¼‰` };
                    } else if (fromCurrency === 'JPY') {
                        const cnyAmount = (num * this.exchangeRates.JPY.CNY).toFixed(4);
                        return { type: 'currency', result: `ï¼ˆ${cnyAmount} äººæ°‘å¸ï¼‰` };
                    } else if (fromCurrency === 'HKD') {
                        const cnyAmount = (num * this.exchangeRates.HKD.CNY).toFixed(4);
                        return { type: 'currency', result: `ï¼ˆ${cnyAmount} äººæ°‘å¸ï¼‰` };
                    }
                }

                return null;
            }

            async getRealTimeExchangeRates(baseCurrency) {
                // ä½¿ç”¨å…è´¹çš„æ±‡ç‡APIï¼ˆExchangeRate-APIï¼‰
                const apiKey = 'YOUR_API_KEY'; // å¯ä»¥ç”³è¯·å…è´¹çš„APIå¯†é’¥
                const url = `https://api.exchangerate-api.com/v4/latest/${baseCurrency}`;
                
                try {
                    const response = await fetch(url);
                    if (response.ok) {
                        const data = await response.json();
                        return data.rates;
                    }
                } catch (error) {
                    console.error('è·å–å®æ—¶æ±‡ç‡å¤±è´¥:', error);
                }
                
                return null;
            }

            handleFormulaQuery(match, input) {
                // æå–å…³é”®è¯
                let keyword = null;
                
                // åŒ¹é…ç‰©ç†å®šå¾‹
                const physicsMatch = input.match(/.*?(ç‰›é¡¿ç¬¬[ä¸€äºŒä¸‰]å®šå¾‹|æ¬§å§†å®šå¾‹|ä¸‡æœ‰å¼•åŠ›å®šå¾‹|èƒ½é‡å®ˆæ’å®šå¾‹).*/);
                if (physicsMatch) keyword = physicsMatch[1];
                
                // åŒ¹é…æ•°å­¦å…¬å¼
                const mathMatch = input.match(/.*?(å‹¾è‚¡å®šç†|äºŒæ¬¡æ–¹ç¨‹|åœ†çš„é¢ç§¯å…¬å¼|çƒçš„ä½“ç§¯å…¬å¼).*/);
                if (mathMatch) keyword = mathMatch[1];
                
                // åŒ¹é…åŒ–å­¦åˆ†å­å¼
                const chemMatch = input.match(/.*?(æ°´|äºŒæ°§åŒ–ç¢³|æ°§æ°”|ç”²çƒ·|ä¹™é†‡)çš„?(?:åˆ†å­å¼|åŒ–å­¦å¼).*/);
                if (chemMatch) {
                    const substance = chemMatch[1];
                    if (substance === 'æ°´') keyword = 'æ°´çš„åˆ†å­å¼';
                    else if (substance === 'äºŒæ°§åŒ–ç¢³') keyword = 'äºŒæ°§åŒ–ç¢³';
                    else if (substance === 'æ°§æ°”') keyword = 'æ°§æ°”çš„åŒ–å­¦å¼';
                    else if (substance === 'ç”²çƒ·') keyword = 'ç”²çƒ·';
                    else if (substance === 'ä¹™é†‡') keyword = 'ä¹™é†‡';
                }
                
                // åŒ¹é…ç‰©ç†å¸¸æ•°
                const constantMatch = input.match(/.*?(å…‰é€Ÿ|å£°é€Ÿ|é‡åŠ›åŠ é€Ÿåº¦|æ™®æœ—å…‹å¸¸æ•°).*/);
                if (constantMatch) keyword = constantMatch[1];
                
                if (keyword && this.formulaDatabase[keyword]) {
                    return { type: 'formula', result: this.formulaDatabase[keyword] };
                }
                
                return null;
            }

            handleCalorieQuery(match, input) {
                // æ£€æŸ¥æ˜¯å¦åŒ…å«çƒ­é‡æŸ¥è¯¢çš„å¦å®šè¯æ±‡ï¼Œå¦‚æœåŒ…å«åˆ™ä¸è§¦å‘
                const negativeWords = ['ä¸å¤ªé«˜', 'ä¸é«˜', 'å¾ˆä½', 'æ¯”è¾ƒä½', 'ä¸å¤š', 'ä¸å°‘', 'è¿˜å¥½', 'ä¸€èˆ¬', 'ä¸ç®—'];
                const hasNegative = negativeWords.some(word => input.includes(word));
                if (hasNegative) {
                    return null;
                }

                // å¤„ç†æ˜ç¡®çš„çƒ­é‡æŸ¥è¯¢ï¼Œå¦‚"æˆ‘åƒäº†100å…‹ç±³é¥­ï¼Œçƒ­é‡"
                const explicitMatch = input.match(/^.*?(\d+)\s*å…‹?\s*(ç±³é¥­|é¢æ¡|è‹¹æœ|é¦™è•‰|é¸¡è›‹|ç‰›å¥¶|é¢åŒ…|åœŸè±†|è¥¿çº¢æŸ¿|é»„ç“œ|é¸¡èƒ¸è‚‰|ç‰›è‚‰|çŒªè‚‰|é±¼è‚‰|ç™½èœ|èƒ¡èåœ|æ©™å­|è‰è“|è‘¡è„|è¥¿ç“œ)[ï¼Œ,]?\s*çƒ­é‡$/);
                if (explicitMatch) {
                    const [, weight, food] = explicitMatch;
                    const baseCalorie = this.calorieDatabase[food];
                    if (baseCalorie) {
                        const totalCalorie = Math.round(baseCalorie * parseInt(weight) / 100);
                        return { type: 'calorie', result: `${totalCalorie}åƒå¡` };
                    }
                }

                // å¤„ç†"XXXå…‹XXXçƒ­é‡"æ ¼å¼
                const weightCalorieMatch = input.match(/^(\d+)\s*å…‹\s*(ç±³é¥­|é¢æ¡|è‹¹æœ|é¦™è•‰|é¸¡è›‹|ç‰›å¥¶|é¢åŒ…|åœŸè±†|è¥¿çº¢æŸ¿|é»„ç“œ|é¸¡èƒ¸è‚‰|ç‰›è‚‰|çŒªè‚‰|é±¼è‚‰|ç™½èœ|èƒ¡èåœ|æ©™å­|è‰è“|è‘¡è„|è¥¿ç“œ)\s*çƒ­é‡$/);
                if (weightCalorieMatch) {
                    const [, weight, food] = weightCalorieMatch;
                    const baseCalorie = this.calorieDatabase[food];
                    if (baseCalorie) {
                        const totalCalorie = Math.round(baseCalorie * parseInt(weight) / 100);
                        return { type: 'calorie', result: `${totalCalorie}åƒå¡` };
                    }
                }

                // å¤„ç†å¸¦gå•ä½çš„æŸ¥è¯¢
                const gWeightMatch = input.match(/^(\d+)\s*g\s*(ç±³é¥­|é¢æ¡|è‹¹æœ|é¦™è•‰|é¸¡è›‹|ç‰›å¥¶|é¢åŒ…|åœŸè±†|è¥¿çº¢æŸ¿|é»„ç“œ|é¸¡èƒ¸è‚‰|ç‰›è‚‰|çŒªè‚‰|é±¼è‚‰|ç™½èœ|èƒ¡èåœ|æ©™å­|è‰è“|è‘¡è„|è¥¿ç“œ)\s*çƒ­é‡$/);
                if (gWeightMatch) {
                    const [, weight, food] = gWeightMatch;
                    const baseCalorie = this.calorieDatabase[food];
                    if (baseCalorie) {
                        const totalCalorie = Math.round(baseCalorie * parseInt(weight) / 100);
                        return { type: 'calorie', result: `${totalCalorie}åƒå¡` };
                    }
                }

                // å¤„ç†ä¸å¸¦é‡é‡çš„çƒ­é‡æŸ¥è¯¢ï¼ˆé»˜è®¤100å…‹ï¼‰
                const foodMatch = input.match(/^(ç±³é¥­|é¢æ¡|è‹¹æœ|é¦™è•‰|é¸¡è›‹|ç‰›å¥¶|é¢åŒ…|åœŸè±†|è¥¿çº¢æŸ¿|é»„ç“œ|é¸¡èƒ¸è‚‰|ç‰›è‚‰|çŒªè‚‰|é±¼è‚‰|ç™½èœ|èƒ¡èåœ|æ©™å­|è‰è“|è‘¡è„|è¥¿ç“œ)\s*çƒ­é‡$/);
                if (foodMatch) {
                    const [, food] = foodMatch;
                    const calorie = this.calorieDatabase[food];
                    if (calorie) {
                        return { type: 'calorie', result: `${calorie}åƒå¡/100å…‹` };
                    }
                }

                return null;
            }

            handleZodiacQuery(match, input) {
                // å¤„ç†å¹´ä»½æŸ¥è¯¢ç”Ÿè‚– - æ”¯æŒå„ç§æ ¼å¼
                const yearMatch = input.match(/.*?(\d{4})\s*å¹´?\s*å±.*/);
                if (yearMatch) {
                    const [, year] = yearMatch;
                    const yearNum = parseInt(year);
                    // 1900å¹´æ˜¯é¼ å¹´ï¼ˆç´¢å¼•0ï¼‰ï¼Œæ‰€ä»¥è®¡ç®—å…¬å¼æ˜¯ (year - 1900) % 12
                    const zodiacIndex = (yearNum - 1900) % 12;
                    const zodiac = this.zodiacAnimals[zodiacIndex];
                    return { type: 'zodiac', result: zodiac };
                }

                // å¤„ç†æ²¡æœ‰"å¹´"å­—çš„æ ¼å¼ï¼Œå¦‚"1990å±ä»€ä¹ˆ"
                const yearMatch2 = input.match(/.*?(\d{4})\s*å±.*/);
                if (yearMatch2) {
                    const [, year] = yearMatch2;
                    const yearNum = parseInt(year);
                    const zodiacIndex = (yearNum - 1900) % 12;
                    const zodiac = this.zodiacAnimals[zodiacIndex];
                    return { type: 'zodiac', result: zodiac };
                }

                // å¤„ç†ç”Ÿè‚–æŸ¥è¯¢å¹´ä»½
                const animalMatch = input.match(/.*?å±\s*(é¼ |ç‰›|è™|å…”|é¾™|è›‡|é©¬|ç¾Š|çŒ´|é¸¡|ç‹—|çŒª)\s*çš„\s*å¹´ä»½.*/);
                if (animalMatch) {
                    const [, animal] = animalMatch;
                    const currentYear = new Date().getFullYear();
                    const animalIndex = this.zodiacAnimals.indexOf(animal);
                    if (animalIndex !== -1) {
                        // æ‰¾åˆ°æœ€è¿‘çš„å‡ ä¸ªå¹´ä»½
                        const years = [];
                        // è®¡ç®—åŸºå‡†å¹´ï¼ˆæœ€è¿‘çš„è¯¥ç”Ÿè‚–å¹´ä»½ï¼‰
                        const baseYear = currentYear - ((currentYear - 1900 - animalIndex) % 12);
                        for (let i = -2; i <= 2; i++) {
                            const year = baseYear + i * 12;
                            if (year > 1900 && year < 2100) {
                                years.push(year);
                            }
                        }
                        return { type: 'zodiac', result: years.sort().join('ã€') + 'å¹´' };
                    }
                }

                const zodiacNameMatch = input.match(/.*?ç”Ÿè‚–\s*(é¼ |ç‰›|è™|å…”|é¾™|è›‡|é©¬|ç¾Š|çŒ´|é¸¡|ç‹—|çŒª).*/);
                if (zodiacNameMatch) {
                    const [, animal] = zodiacNameMatch;
                    const fullName = this.zodiacNames[animal];
                    return { type: 'zodiac', result: fullName };
                }

                return null;
            }

            handleConstellationQuery(match, input) {
                const today = new Date();
                
                // å¤„ç†"ä»Šå¤©/æ˜å¤©/æ˜¨å¤©ä»€ä¹ˆæ˜Ÿåº§"
                const todayMatch = input.match(/^.*?(ä»Šå¤©|æ˜å¤©|æ˜¨å¤©)\s*(ä»€ä¹ˆæ˜Ÿåº§|æ˜Ÿåº§)[ï¼Ÿ?]?$/);
                if (todayMatch) {
                    const [, dayType] = todayMatch;
                    let targetDate = new Date();
                    
                    switch (dayType) {
                        case 'æ˜å¤©': targetDate.setDate(targetDate.getDate() + 1); break;
                        case 'æ˜¨å¤©': targetDate.setDate(targetDate.getDate() - 1); break;
                    }
                    
                    const constellation = this.getConstellation(targetDate.getMonth() + 1, targetDate.getDate());
                    return { type: 'constellation', result: constellation.name };
                }

                // å¤„ç†æ—¥æœŸæŸ¥æ˜Ÿåº§
                const dateMatch = input.match(/^.*?(\d{1,2})\s*æœˆ\s*(\d{1,2})\s*æ—¥\s*(æ˜¯ä»€ä¹ˆæ˜Ÿåº§|æ˜Ÿåº§)[ï¼Ÿ?]?$/);
                if (dateMatch) {
                    const [, month, day] = dateMatch;
                    const constellation = this.getConstellation(parseInt(month), parseInt(day));
                    return { type: 'constellation', result: `${constellation.name}ï¼ˆ${constellation.element}æ˜Ÿåº§ï¼Œå®ˆæŠ¤æ˜Ÿï¼š${constellation.planet}ï¼‰` };
                }

                // å¤„ç†å¸¦å¹´ä»½çš„æ—¥æœŸæŸ¥æ˜Ÿåº§
                const yearDateMatch = input.match(/^.*?(\d{4})\s*å¹´\s*(\d{1,2})\s*æœˆ\s*(\d{1,2})\s*æ—¥\s*(æ˜¯ä»€ä¹ˆæ˜Ÿåº§|æ˜Ÿåº§)[ï¼Ÿ?]?$/);
                if (yearDateMatch) {
                    const [, year, month, day] = yearDateMatch;
                    const constellation = this.getConstellation(parseInt(month), parseInt(day));
                    return { type: 'constellation', result: constellation.name };
                }

                // å¤„ç†"æˆ‘æ˜¯XæœˆXæ—¥ç”Ÿ"æ ¼å¼
                const birthMatch = input.match(/^.*?æˆ‘æ˜¯\s*(\d{1,2})\s*æœˆ\s*(\d{1,2})\s*æ—¥\s*(ç”Ÿ|å‡ºç”Ÿ)[ï¼Œ,]?\s*(ä»€ä¹ˆæ˜Ÿåº§|æ˜Ÿåº§)[ï¼Ÿ?]?$/);
                if (birthMatch) {
                    const [, month, day] = birthMatch;
                    const constellation = this.getConstellation(parseInt(month), parseInt(day));
                    return { type: 'constellation', result: constellation.name };
                }

                // å¤„ç†ç®€åŒ–æ ¼å¼ï¼šX.Xæˆ–X/X
                const simpleMatch = input.match(/^.*?(\d{1,2})\s*[æœˆ./]\s*(\d{1,2})\s*[æ—¥å·]?\s*(ä»€ä¹ˆæ˜Ÿåº§|æ˜Ÿåº§)[ï¼Ÿ?]?$/);
                if (simpleMatch) {
                    const [, month, day] = simpleMatch;
                    const constellation = this.getConstellation(parseInt(month), parseInt(day));
                    return { type: 'constellation', result: constellation.name };
                }

                // å¤„ç†æ˜Ÿåº§æŸ¥æ—¥æœŸ
                const constellationMatch = input.match(/^.*?(ç™½ç¾Šåº§|é‡‘ç‰›åº§|åŒå­åº§|å·¨èŸ¹åº§|ç‹®å­åº§|å¤„å¥³åº§|å¤©ç§¤åº§|å¤©èåº§|å°„æ‰‹åº§|æ‘©ç¾¯åº§|æ°´ç“¶åº§|åŒé±¼åº§)\s*(æ—¥æœŸ|æ—¶é—´|ä»€ä¹ˆæ—¶å€™)[ï¼Ÿ?]?$/);
                if (constellationMatch) {
                    const [, constellationName] = constellationMatch;
                    const constellation = this.constellations.find(c => c.name === constellationName);
                    if (constellation) {
                        const [startMonth, startDay] = constellation.start;
                        const [endMonth, endDay] = constellation.end;
                        
                        if (startMonth === endMonth) {
                            return { type: 'constellation', result: `${startMonth}æœˆ${startDay}æ—¥ - ${endMonth}æœˆ${endDay}æ—¥` };
                        } else if (endMonth < startMonth) {
                            // è·¨å¹´çš„æƒ…å†µï¼ˆå¦‚æ‘©ç¾¯åº§ï¼‰
                            return { type: 'constellation', result: `${startMonth}æœˆ${startDay}æ—¥ - æ¬¡å¹´${endMonth}æœˆ${endDay}æ—¥` };
                        } else {
                            return { type: 'constellation', result: `${startMonth}æœˆ${startDay}æ—¥ - ${endMonth}æœˆ${endDay}æ—¥` };
                        }
                    }
                }

                return null;
            }

            getConstellation(month, day) {
                for (const constellation of this.constellations) {
                    const [startMonth, startDay] = constellation.start;
                    const [endMonth, endDay] = constellation.end;
                    
                    if (startMonth === endMonth) {
                        // åŒä¸€ä¸ªæœˆå†…
                        if (month === startMonth && day >= startDay && day <= endDay) {
                            return constellation;
                        }
                    } else if (endMonth > startMonth) {
                        // è·¨æœˆä½†ä¸è·¨å¹´
                        if ((month === startMonth && day >= startDay) || 
                            (month === endMonth && day <= endDay) ||
                            (month > startMonth && month < endMonth)) {
                            return constellation;
                        }
                    } else {
                        // è·¨å¹´çš„æƒ…å†µï¼ˆå¦‚æ‘©ç¾¯åº§ï¼š12æœˆ22æ—¥ - 1æœˆ19æ—¥ï¼‰
                        if ((month === startMonth && day >= startDay) || 
                            (month === endMonth && day <= endDay)) {
                            return constellation;
                        }
                    }
                }
                return this.constellations[0]; // é»˜è®¤è¿”å›ç¬¬ä¸€ä¸ªæ˜Ÿåº§
            }

            getLunarDate(date) {
                // ç®€åŒ–çš„å†œå†è½¬æ¢ï¼ˆä½¿ç”¨è¿‘ä¼¼ç®—æ³•ï¼‰
                const lunarMonths = ['æ­£æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 
                                   'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'å†¬æœˆ', 'è…Šæœˆ'];
                const lunarDays = ['åˆä¸€', 'åˆäºŒ', 'åˆä¸‰', 'åˆå››', 'åˆäº”', 'åˆå…­', 'åˆä¸ƒ', 'åˆå…«', 'åˆä¹', 'åˆå',
                                 'åä¸€', 'åäºŒ', 'åä¸‰', 'åå››', 'åäº”', 'åå…­', 'åä¸ƒ', 'åå…«', 'åä¹', 'äºŒå',
                                 'å»¿ä¸€', 'å»¿äºŒ', 'å»¿ä¸‰', 'å»¿å››', 'å»¿äº”', 'å»¿å…­', 'å»¿ä¸ƒ', 'å»¿å…«', 'å»¿ä¹', 'ä¸‰å'];
                
                // ä½¿ç”¨ç®€åŒ–ç®—æ³•ä¼°ç®—å†œå†ï¼ˆå®é™…åº”è¯¥ä½¿ç”¨ä¸“ä¸šçš„å†œå†è½¬æ¢åº“ï¼‰
                const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
                const lunarMonth = Math.floor((dayOfYear - 20) / 29.5) % 12;
                const lunarDay = Math.floor((dayOfYear - 20) % 29.5);
                
                const monthName = lunarMonths[lunarMonth >= 0 ? lunarMonth : lunarMonth + 12];
                const dayName = lunarDays[lunarDay >= 0 && lunarDay < 30 ? lunarDay : 0];
                
                return `${monthName}${dayName}`;
            }

            getHoliday(date) {
                const year = date.getFullYear();
                const dateStr = date.toISOString().split('T')[0];
                
                // æ£€æŸ¥æ˜¯å¦ä¸ºæ³•å®šèŠ‚å‡æ—¥
                if (this.holidays[year]) {
                    for (const [holiday, holidayDate] of Object.entries(this.holidays[year])) {
                        if (holidayDate === dateStr) {
                            return holiday;
                        }
                    }
                }
                
                // æ£€æŸ¥å›ºå®šèŠ‚æ—¥
                const month = date.getMonth() + 1;
                const day = date.getDate();
                
                const fixedHolidays = {
                    '1-1': 'å…ƒæ—¦',
                    '3-8': 'å¦‡å¥³èŠ‚',
                    '3-12': 'æ¤æ ‘èŠ‚',
                    '4-1': 'æ„šäººèŠ‚',
                    '5-4': 'é’å¹´èŠ‚',
                    '6-1': 'å„¿ç«¥èŠ‚',
                    '7-1': 'å»ºå…šèŠ‚',
                    '8-1': 'å»ºå†›èŠ‚',
                    '9-10': 'æ•™å¸ˆèŠ‚',
                    '10-1': 'å›½åº†èŠ‚',
                    '12-25': 'åœ£è¯èŠ‚'
                };
                
                const key = `${month}-${day}`;
                return fixedHolidays[key] || null;
            }

            getNextHoliday(currentDate) {
                const year = currentDate.getFullYear();
                const currentDateStr = currentDate.toISOString().split('T')[0];
                
                // åˆå¹¶æ‰€æœ‰èŠ‚å‡æ—¥
                const allHolidays = [];
                
                // æ·»åŠ æ³•å®šèŠ‚å‡æ—¥
                if (this.holidays[year]) {
                    for (const [name, date] of Object.entries(this.holidays[year])) {
                        if (date > currentDateStr) {
                            allHolidays.push({ name, date });
                        }
                    }
                }
                
                // æ·»åŠ ä¸‹ä¸€å¹´çš„èŠ‚å‡æ—¥ï¼ˆå¦‚æœå½“å¹´çš„éƒ½è¿‡äº†ï¼‰
                if (this.holidays[year + 1]) {
                    for (const [name, date] of Object.entries(this.holidays[year + 1])) {
                        allHolidays.push({ name, date });
                    }
                }
                
                // æŒ‰æ—¥æœŸæ’åº
                allHolidays.sort((a, b) => a.date.localeCompare(b.date));
                
                if (allHolidays.length > 0) {
                    const nextHoliday = allHolidays[0];
                    const holidayDate = new Date(nextHoliday.date);
                    const daysLeft = Math.ceil((holidayDate - currentDate) / (1000 * 60 * 60 * 24));
                    
                    return {
                        name: nextHoliday.name,
                        date: `${holidayDate.getMonth() + 1}æœˆ${holidayDate.getDate()}æ—¥`,
                        daysLeft
                    };
                }
                
                return null;
            }

            formatOutput(result) {
                if (!result) return '';
                return result.result || '';
            }
        }

        // å…¨å±€å˜é‡
        const smartCompletion = new ChineseSmartCompletion();
        let history = JSON.parse(localStorage.getItem('completionHistory') || '[]');

        // é¡µé¢åŠ è½½æ—¶æ¢å¤å†å²è®°å½•
        window.onload = function() {
            displayHistory();
            
            // å®æ—¶è¾“å…¥å¤„ç†
            let inputTimer = null;
            document.getElementById('userInput').addEventListener('input', function(e) {
                clearTimeout(inputTimer);
                const value = e.target.value.trim();
                
                // å¯¹äºç®€å•è¡¨è¾¾å¼ç«‹å³å¤„ç†
                if (value && value.match(/^\d+[+\-*/]\d+$/)) {
                    realTimeProcess();
                } else {
                    // å…¶ä»–æƒ…å†µä½¿ç”¨é˜²æŠ–
                    inputTimer = setTimeout(realTimeProcess, 100);
                }
            });

            // å›è½¦é”®è§¦å‘å¤„ç†
            document.getElementById('userInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    processInput();
                }
            });
        };

        // Tabåˆ‡æ¢åŠŸèƒ½
        function switchTab(tabId) {
            // ç§»é™¤æ‰€æœ‰æ´»è·ƒçŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
            
            // æ¿€æ´»å½“å‰tab
            event.target.classList.add('active');
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }

        // è®¾ç½®è¾“å…¥å†…å®¹
        function setInput(text) {
            document.getElementById('userInput').value = text;
            document.getElementById('userInput').focus();
            realTimeProcess(); // è®¾ç½®å†…å®¹åç«‹å³å¤„ç†
        }

        // è°ƒè¯•æ—¥å¿—åŠŸèƒ½
        function addDebugLog(message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            
            if (data) {
                console.log(logEntry, data);
            } else {
                console.log(logEntry);
            }
            
            // åœ¨é¡µé¢æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
            let debugContainer = document.getElementById('debug-container');
            if (!debugContainer) {
                debugContainer = document.createElement('div');
                debugContainer.id = 'debug-container';
                debugContainer.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    width: 300px;
                    max-height: 200px;
                    background: rgba(0,0,0,0.8);
                    color: white;
                    font-size: 11px;
                    padding: 10px;
                    border-radius: 8px;
                    overflow-y: auto;
                    z-index: 1000;
                    display: none;
                `;
                document.body.appendChild(debugContainer);
            }
            
            const logDiv = document.createElement('div');
            logDiv.textContent = logEntry;
            debugContainer.insertBefore(logDiv, debugContainer.firstChild);
            
            // ä¿æŒæœ€æ–°10æ¡æ—¥å¿—
            while (debugContainer.children.length > 10) {
                debugContainer.removeChild(debugContainer.lastChild);
            }
        }

        // åˆ‡æ¢è°ƒè¯•é¢æ¿æ˜¾ç¤º/éšè—
        function toggleDebug() {
            const debugContainer = document.getElementById('debug-container');
            if (debugContainer) {
                debugContainer.style.display = debugContainer.style.display === 'none' ? 'block' : 'none';
            }
        }

        // å®æ—¶å¤„ç†å‡½æ•°
        async function realTimeProcess() {
            const input = document.getElementById('userInput').value.trim();
            const resultElement = document.getElementById('result');
            
            addDebugLog(`è¾“å…¥å†…å®¹: "${input}"`);
            
            if (!input) {
                resultElement.innerHTML = '<div class="result-empty">åœ¨ä¸Šæ–¹è¾“å…¥å†…å®¹ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¯†åˆ«å¹¶æ™ºèƒ½ç»­å†™</div>';
                addDebugLog('è¾“å…¥ä¸ºç©ºï¼Œæ˜¾ç¤ºæç¤º');
                return;
            }

            try {
                addDebugLog('å¼€å§‹å¤„ç†è¾“å…¥...');
                const result = await smartCompletion.process(input);
                addDebugLog('å¤„ç†ç»“æœ:', result);
                
                if (result) {
                    const categoryNames = {
                        'math': 'ğŸ”¢ æ•°å­¦è®¡ç®—',
                        'date': 'ğŸ“… æ—¥æœŸæ—¶é—´', 
                        'timezone': 'ğŸŒ æ—¶åŒºæŸ¥è¯¢',
                        'unit': 'ğŸ”„ å•ä½è½¬æ¢',
                        'currency': 'ğŸ’° æ±‡ç‡æ¢ç®—',
                        'formula': 'ğŸ“ å…¬å¼å®šå¾‹',
                        'calorie': 'ğŸ çƒ­é‡æŸ¥è¯¢',
                        'zodiac': 'ğŸ² ç”Ÿè‚–æŸ¥è¯¢',
                        'constellation': 'â­ æ˜Ÿåº§æŸ¥è¯¢'
                    };
                    
                    const categoryName = categoryNames[result.category] || 'ğŸ¤– æ™ºèƒ½è¯†åˆ«';
                    const output = result.result;
                    
                    addDebugLog(`åŒ¹é…æˆåŠŸ! ç±»åˆ«: ${result.category}`);
                    
                    resultElement.innerHTML = `
                        <div class="result-success">
                            <span class="category-tag">${categoryName}</span>
                            ${input}${output}
                        </div>
                    `;
                } else {
                    addDebugLog('æ— åŒ¹é…ç»“æœï¼Œæ˜¾ç¤ºè¾“å…¥ä¸­çŠ¶æ€');
                    resultElement.innerHTML = `<span class="result-empty">è¾“å…¥ä¸­...</span>`;
                }
            } catch (error) {
                addDebugLog(`å¤„ç†é”™è¯¯: ${error.message}`);
                resultElement.innerHTML = `<span class="result-error">å¤„ç†å‡ºé”™ï¼š${error.message}</span>`;
            }
        }

        // å¤„ç†è¾“å…¥
        async function processInput() {
            const input = document.getElementById('userInput').value.trim();
            if (!input) {
                alert('è¯·è¾“å…¥è¦æµ‹è¯•çš„å†…å®¹');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading();

            try {
                // å¤„ç†è¾“å…¥
                const result = await smartCompletion.process(input);
                
                // æ˜¾ç¤ºç»“æœ
                const resultElement = document.getElementById('result');
                if (result) {
                    const categoryNames = {
                        'math': 'ğŸ”¢ æ•°å­¦è®¡ç®—',
                        'date': 'ğŸ“… æ—¥æœŸæ—¶é—´', 
                        'timezone': 'ğŸŒ æ—¶åŒºæŸ¥è¯¢',
                        'unit': 'ğŸ”„ å•ä½è½¬æ¢',
                        'currency': 'ğŸ’° æ±‡ç‡æ¢ç®—',
                        'formula': 'ğŸ“ å…¬å¼å®šå¾‹',
                        'calorie': 'ğŸ çƒ­é‡æŸ¥è¯¢',
                        'zodiac': 'ğŸ² ç”Ÿè‚–æŸ¥è¯¢',
                        'constellation': 'â­ æ˜Ÿåº§æŸ¥è¯¢'
                    };
                    
                    const categoryName = categoryNames[result.category] || 'ğŸ¤– æ™ºèƒ½è¯†åˆ«';
                    const output = result.result;
                    const fullOutput = input + output;
                    
                    resultElement.innerHTML = `
                        <div class="result-success">
                            <span class="category-tag">${categoryName}</span>
                            ${fullOutput}
                        </div>
                    `;
                    
                    // æ·»åŠ åˆ°å†å²è®°å½•
                    addToHistory(input, fullOutput);
                } else {
                    resultElement.innerHTML = `<span class="result-error">æš‚ä¸æ”¯æŒæ­¤ç±»å‹çš„å†…å®¹ï¼š"${input}"</span>`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `<span class="result-error">å¤„ç†å‡ºé”™ï¼š${error.message}</span>`;
            } finally {
                hideLoading();
            }
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            document.querySelector('.loading').style.display = 'block';
            document.getElementById('result').style.opacity = '0.3';
        }

        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            document.querySelector('.loading').style.display = 'none';
            document.getElementById('result').style.opacity = '1';
        }

        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            document.getElementById('userInput').value = '';
            document.getElementById('result').innerHTML = '<div class="result-empty">åœ¨ä¸Šæ–¹è¾“å…¥å†…å®¹ï¼Œç‚¹å‡»"æ™ºèƒ½ç»­å†™"æŒ‰é’®æŸ¥çœ‹ç»“æœ</div>';
            document.getElementById('userInput').focus();
        }

        // æ·»åŠ åˆ°å†å²è®°å½•
        function addToHistory(input, output) {
            const historyItem = {
                input: input,
                output: output,
                timestamp: new Date().toLocaleString('zh-CN')
            };
            
            history.unshift(historyItem);
            if (history.length > 20) {
                history = history.slice(0, 20);
            }
            
            localStorage.setItem('completionHistory', JSON.stringify(history));
            displayHistory();
        }

        // æ˜¾ç¤ºå†å²è®°å½•
        function displayHistory() {
            const container = document.getElementById('historyContainer');
            
            if (history.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #64748b; padding: 20px;">æš‚æ— æµ‹è¯•è®°å½•</div>';
                return;
            }

            container.innerHTML = history.map(item => `
                <div class="history-item">
                    <div class="history-input">è¾“å…¥ï¼š${item.input}</div>
                    <div class="history-output">è¾“å‡ºï¼š${item.output}</div>
                    <div style="font-size: 12px; color: #64748b; margin-top: 5px;">${item.timestamp}</div>
                </div>
            `).join('');
        }

        // æ¸…ç©ºå†å²è®°å½•
        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) {
                history = [];
                localStorage.removeItem('completionHistory');
                displayHistory();
            }
        }
    </script>
</body>
</html> 